(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,74455,e=>{"use strict";e.s(["MultiAudioPlayer",()=>P,"default",()=>k],74455);var t=e.i(843476),i=e.i(576173),n=e.i(647163),r=e.i(472068),s=e.i(531278),o=e.i(299023),a=e.i(107233),l=e.i(440160),h=e.i(382373),u=e.i(554212),d=e.i(520354),c=e.i(951577),p=e.i(271645),m=e.i(946858);class g{on(e,t,i){if(this.listeners[e]||(this.listeners[e]=new Set),null==i?void 0:i.once){var n=this;let i=function(){for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];n.un(e,i),t(...s)};return this.listeners[e].add(i),()=>this.un(e,i)}return this.listeners[e].add(t),()=>this.un(e,t)}un(e,t){var i;null==(i=this.listeners[e])||i.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.listeners[e]&&this.listeners[e].forEach(e=>e(...i))}constructor(){this.listeners={}}}class f extends g{onInit(){}_init(e){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e()),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}constructor(e){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=e}}function v(e,t,i){let n=function e(t,i){let n=i.xmlns?document.createElementNS(i.xmlns,t):document.createElement(t);for(let[t,r]of Object.entries(i))if("children"===t&&r)for(let[t,i]of Object.entries(r))i instanceof Node?n.appendChild(i):"string"==typeof i?n.appendChild(document.createTextNode(i)):n.appendChild(e(t,i));else"style"===t?Object.assign(n.style,r):"textContent"===t?n.textContent=r:n.setAttribute(t,r.toString());return n}(e,t||{});return null==i||i.appendChild(n),n}function b(e){let t=e,i=new Set;return{get value(){return t},set(e){Object.is(t,e)||(t=e,i.forEach(e=>e(t)))},update(e){this.set(e(t))},subscribe:e=>(i.add(e),()=>i.delete(e))}}function y(e,t){let i,n=()=>{i&&(i(),i=void 0),i=e()},r=t.map(e=>e.subscribe(n));return n(),()=>{i&&(i(),i=void 0),r.forEach(e=>e())}}function x(e,t){let i=b(null),n=e=>{i.set(e)};return e.addEventListener(t,n),i._cleanup=()=>{e.removeEventListener(t,n)},i}function w(e){let t=e._cleanup;"function"==typeof t&&t()}function C(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{threshold:i=3,mouseButton:n=0,touchDelay:r=100}=t,s=b(null),o=new Map,a=matchMedia("(pointer: coarse)").matches,l=()=>{},h=t=>{if(t.button!==n||(o.set(t.pointerId,t),o.size>1))return;let h=t.clientX,u=t.clientY,d=!1,c=Date.now(),{left:p,top:m}=e.getBoundingClientRect(),g=e=>{if(e.defaultPrevented||o.size>1||a&&Date.now()-c<r)return;let t=e.clientX,n=e.clientY,l=t-h,g=n-u;(d||Math.abs(l)>i||Math.abs(g)>i)&&(e.preventDefault(),e.stopPropagation(),d||(s.set({type:"start",x:h-p,y:u-m}),d=!0),s.set({type:"move",x:t-p,y:n-m,deltaX:l,deltaY:g}),h=t,u=n)},f=e=>{if(o.delete(e.pointerId),d){let t=e.clientX,i=e.clientY;s.set({type:"end",x:t-p,y:i-m})}l()},v=e=>{o.delete(e.pointerId),e.relatedTarget&&e.relatedTarget!==document.documentElement||f(e)},b=e=>{d&&(e.stopPropagation(),e.preventDefault())},y=e=>{e.defaultPrevented||o.size>1||d&&e.preventDefault()};document.addEventListener("pointermove",g),document.addEventListener("pointerup",f),document.addEventListener("pointerout",v),document.addEventListener("pointercancel",v),document.addEventListener("touchmove",y,{passive:!1}),document.addEventListener("click",b,{capture:!0}),l=()=>{document.removeEventListener("pointermove",g),document.removeEventListener("pointerup",f),document.removeEventListener("pointerout",v),document.removeEventListener("pointercancel",v),document.removeEventListener("touchmove",y),setTimeout(()=>{document.removeEventListener("click",b,{capture:!0})},10)}};return e.addEventListener("pointerdown",h),{signal:s,cleanup:()=>{l(),e.removeEventListener("pointerdown",h),o.clear(),w(s)}}}class S extends g{clampPosition(e){return Math.max(0,Math.min(this.totalDuration,e))}setPart(){var e;let t=this.start===this.end;null==(e=this.element)||e.setAttribute("part","".concat(t?"marker":"region"," ").concat(this.id))}addResizeHandles(e){let t={position:"absolute",zIndex:"2",width:"6px",height:"100%",top:"0",cursor:"ew-resize",wordBreak:"keep-all"},i=v("div",{part:"region-handle region-handle-left",style:Object.assign(Object.assign({},t),{left:"0",borderLeft:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"2px 0 0 2px"})},e),n=v("div",{part:"region-handle region-handle-right",style:Object.assign(Object.assign({},t),{right:"0",borderRight:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"0 2px 2px 0"})},e),r=C(i,{threshold:1}),s=C(n,{threshold:1}),o=y(()=>{let e=r.signal.value;e&&("move"===e.type&&void 0!==e.deltaX?this.onResize(e.deltaX,"start"):"end"===e.type&&this.onEndResizing("start"))},[r.signal]),a=y(()=>{let e=s.signal.value;e&&("move"===e.type&&void 0!==e.deltaX?this.onResize(e.deltaX,"end"):"end"===e.type&&this.onEndResizing("end"))},[s.signal]);this.subscriptions.push(()=>{o(),a(),r.cleanup(),s.cleanup()})}removeResizeHandles(e){let t=e.querySelector('[part*="region-handle-left"]'),i=e.querySelector('[part*="region-handle-right"]');t&&e.removeChild(t),i&&e.removeChild(i)}initElement(){if(this.isRemoved)return null;let e=this.start===this.end,t=0,i=100;this.channelIdx>=0&&this.numberOfChannels>0&&this.channelIdx<this.numberOfChannels&&(t=(i=100/this.numberOfChannels)*this.channelIdx);let n=v("div",{style:{position:"absolute",top:"".concat(t,"%"),height:"".concat(i,"%"),backgroundColor:e?"none":this.color,borderLeft:e?"2px solid "+this.color:"none",borderRadius:"2px",boxSizing:"border-box",transition:"background-color 0.2s ease",cursor:this.drag?"grab":"default",pointerEvents:"all"}});return!e&&this.resize&&this.addResizeHandles(n),n}renderPosition(){if(!this.element)return;let e=this.start/this.totalDuration,t=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*e+"%",this.element.style.right=100*t+"%"}toggleCursor(e){var t;this.drag&&(null==(t=this.element)?void 0:t.style)&&(this.element.style.cursor=e?"grabbing":"grab")}initMouseEvents(){let{element:e}=this;if(!e)return;let t=x(e,"click"),i=x(e,"mouseenter"),n=x(e,"mouseleave"),r=x(e,"dblclick"),s=x(e,"pointerdown"),o=x(e,"pointerup"),a=t.subscribe(e=>e&&this.emit("click",e)),l=i.subscribe(e=>e&&this.emit("over",e)),h=n.subscribe(e=>e&&this.emit("leave",e)),u=r.subscribe(e=>e&&this.emit("dblclick",e)),d=s.subscribe(e=>e&&this.toggleCursor(!0)),c=o.subscribe(e=>e&&this.toggleCursor(!1));this.subscriptions.push(()=>{a(),l(),h(),u(),d(),c(),w(t),w(i),w(n),w(r),w(s),w(o)});let p=C(e),m=y(()=>{let e=p.signal.value;e&&("start"===e.type?this.toggleCursor(!0):"move"===e.type&&void 0!==e.deltaX?this.onMove(e.deltaX):"end"===e.type&&(this.toggleCursor(!1),this.drag&&this.emit("update-end")))},[p.signal]);this.subscriptions.push(()=>{m(),p.cleanup()}),this.contentEditable&&this.content&&(this.contentClickListener=e=>this.onContentClick(e),this.contentBlurListener=()=>this.onContentBlur(),this.content.addEventListener("click",this.contentClickListener),this.content.addEventListener("blur",this.contentBlurListener))}_onUpdate(e,t,i){var n;if(!(null==(n=this.element)?void 0:n.parentElement))return;let{width:r}=this.element.parentElement.getBoundingClientRect(),s=e/r*this.totalDuration,o=t&&"start"!==t?this.start:this.start+s,a=t&&"end"!==t?this.end:this.end+s,l=void 0!==i;l&&this.updatingSide&&this.updatingSide!==t&&("start"===this.updatingSide?o=i:a=i),o=Math.max(0,o);let h=(a=Math.min(this.totalDuration,a))-o;this.updatingSide=t;let u=h>=this.minLength&&h<=this.maxLength;o<=a&&(u||l)&&(this.start=o,this.end=a,this.renderPosition(),this.emit("update",t))}onMove(e){this.drag&&this._onUpdate(e)}onResize(e,t){this.resize&&(this.resizeStart||"start"!==t)&&(this.resizeEnd||"end"!==t)&&this._onUpdate(e,t)}onEndResizing(e){this.resize&&(this.emit("update-end",e),this.updatingSide=void 0)}onContentClick(e){e.stopPropagation(),e.target.focus(),this.emit("click",e)}onContentBlur(){this.emit("update-end")}_setTotalDuration(e){this.totalDuration=e,this.renderPosition()}play(e){this.emit("play",e&&this.end!==this.start?this.end:void 0)}getContent(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return t?this.content||void 0:this.element instanceof HTMLElement?(null==(e=this.content)?void 0:e.innerHTML)||void 0:""}setContent(e){var t;if(this.element)if(this.content&&this.contentEditable&&(this.contentClickListener&&this.content.removeEventListener("click",this.contentClickListener),this.contentBlurListener&&this.content.removeEventListener("blur",this.contentBlurListener)),null==(t=this.content)||t.remove(),e){if("string"==typeof e){let t=this.start===this.end;this.content=v("div",{style:{padding:"0.2em ".concat(t?.2:.4,"em"),display:"inline-block"},textContent:e})}else this.content=e;this.contentEditable&&(this.content.contentEditable="true",this.contentClickListener=e=>this.onContentClick(e),this.contentBlurListener=()=>this.onContentBlur(),this.content.addEventListener("click",this.contentClickListener),this.content.addEventListener("blur",this.contentBlurListener)),this.content.setAttribute("part","region-content"),this.element.appendChild(this.content),this.emit("content-changed")}else this.content=void 0}setOptions(e){var t,i;if(this.element){if(e.color&&(this.color=e.color,this.element.style.backgroundColor=this.color),void 0!==e.drag&&(this.drag=e.drag,this.element.style.cursor=this.drag?"grab":"default"),void 0!==e.start||void 0!==e.end){let n=this.start===this.end;this.start=this.clampPosition(null!=(t=e.start)?t:this.start),this.end=this.clampPosition(null!=(i=e.end)?i:n?this.start:this.end),this.renderPosition(),this.setPart()}if(e.content&&this.setContent(e.content),e.id&&(this.id=e.id,this.setPart()),void 0!==e.resize&&e.resize!==this.resize){let t=this.start===this.end;this.resize=e.resize,this.resize&&!t?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}void 0!==e.resizeStart&&(this.resizeStart=e.resizeStart),void 0!==e.resizeEnd&&(this.resizeEnd=e.resizeEnd)}}remove(){this.isRemoved=!0,this.emit("remove"),this.subscriptions.forEach(e=>e()),this.subscriptions=[],this.content&&this.contentEditable&&(this.contentClickListener&&(this.content.removeEventListener("click",this.contentClickListener),this.contentClickListener=void 0),this.contentBlurListener&&(this.content.removeEventListener("blur",this.contentBlurListener),this.contentBlurListener=void 0)),this.element&&(this.element.remove(),this.element=null),this.unAll()}constructor(e,t,i=0){var n,r,s,o,a,l,h,u,d,c;super(),this.totalDuration=t,this.numberOfChannels=i,this.element=null,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.subscriptions=[],this.updatingSide=void 0,this.isRemoved=!1,this.subscriptions=[],this.id=e.id||"region-".concat(Math.random().toString(32).slice(2)),this.start=this.clampPosition(e.start),this.end=this.clampPosition(null!=(n=e.end)?n:e.start),this.drag=null==(r=e.drag)||r,this.resize=null==(s=e.resize)||s,this.resizeStart=null==(o=e.resizeStart)||o,this.resizeEnd=null==(a=e.resizeEnd)||a,this.color=null!=(l=e.color)?l:"rgba(0, 0, 0, 0.1)",this.minLength=null!=(h=e.minLength)?h:this.minLength,this.maxLength=null!=(u=e.maxLength)?u:this.maxLength,this.channelIdx=null!=(d=e.channelIdx)?d:-1,this.contentEditable=null!=(c=e.contentEditable)?c:this.contentEditable,this.element=this.initElement(),this.setContent(e.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}}class E extends f{static create(e){return new E(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer),this.subscriptions.push(this.wavesurfer.on("ready",e=>{this.regions.forEach(t=>t._setTotalDuration(e))}));let e=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",t=>{let i=this.regions.filter(e=>e.start<=t&&(e.end===e.start?e.start+.05:e.end)>=t);i.forEach(t=>{e.includes(t)||this.emit("region-in",t)}),e.forEach(e=>{i.includes(e)||this.emit("region-out",e)}),e=i}))}initRegionsContainer(){return v("div",{part:"regions-container",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"5",pointerEvents:"none"}})}getRegions(){return this.regions}avoidOverlapping(e){e.content&&setTimeout(()=>{let t=e.content,i=t.getBoundingClientRect(),n=this.regions.map(t=>{if(t===e||!t.content)return 0;let n=t.content.getBoundingClientRect();return i.left<n.left+n.width&&n.left<i.left+i.width?n.height:0}).reduce((e,t)=>e+t,0);t.style.marginTop="".concat(n,"px")},10)}adjustScroll(e){var t,i;if(!e.element)return;let n=null==(i=null==(t=this.wavesurfer)?void 0:t.getWrapper())?void 0:i.parentElement;if(!n)return;let{clientWidth:r,scrollWidth:s}=n;if(s<=r)return;let o=n.getBoundingClientRect(),a=e.element.getBoundingClientRect(),l=a.left-o.left,h=a.right-o.left;l<0?n.scrollLeft+=l:h>r&&(n.scrollLeft+=h-r)}virtualAppend(e,t,i){let n=()=>{if(!this.wavesurfer)return;let n=this.wavesurfer.getWidth(),r=this.wavesurfer.getScroll(),s=t.clientWidth,o=this.wavesurfer.getDuration(),a=Math.round(e.start/o*s),l=a+(Math.round((e.end-e.start)/o*s)||1)>r&&a<r+n;l&&!i.parentElement?t.appendChild(i):!l&&i.parentElement&&i.remove()};setTimeout(()=>{if(!this.wavesurfer||!e.element)return;n();let t=this.wavesurfer.on("scroll",n),i=this.wavesurfer.on("zoom",n),r=this.wavesurfer.on("resize",n);this.subscriptions.push(t,i,r),e.once("remove",()=>{t(),i(),r()})},0)}saveRegion(e){if(!e.element)return;this.virtualAppend(e,this.regionsContainer,e.element),this.avoidOverlapping(e),this.regions.push(e);let t=[e.on("update",t=>{t||this.adjustScroll(e),this.emit("region-update",e,t)}),e.on("update-end",t=>{this.avoidOverlapping(e),this.emit("region-updated",e,t)}),e.on("play",t=>{var i;null==(i=this.wavesurfer)||i.play(e.start,t)}),e.on("click",t=>{this.emit("region-clicked",e,t)}),e.on("dblclick",t=>{this.emit("region-double-clicked",e,t)}),e.on("content-changed",()=>{this.emit("region-content-changed",e)}),e.once("remove",()=>{t.forEach(e=>e()),this.regions=this.regions.filter(t=>t!==e),this.emit("region-removed",e)})];this.subscriptions.push(...t),this.emit("region-created",e)}addRegion(e){var t,i;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");let n=this.wavesurfer.getDuration(),r=new S(e,n,null==(i=null==(t=this.wavesurfer)?void 0:t.getDecodedData())?void 0:i.numberOfChannels);return this.emit("region-initialized",r),n?this.saveRegion(r):this.subscriptions.push(this.wavesurfer.once("ready",e=>{r._setTotalDuration(e),this.saveRegion(r)})),r}enableDragSelection(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=null==(t=this.wavesurfer)?void 0:t.getWrapper();if(!(n&&n instanceof HTMLElement))return()=>{};let r=null,s=0,o=0,a=C(n,{threshold:i}),l=y(()=>{var t,i;let n=a.signal.value;if(n)if("start"===n.type){if(s=n.x,!this.wavesurfer)return;let a=this.wavesurfer.getDuration(),l=null==(i=null==(t=this.wavesurfer)?void 0:t.getDecodedData())?void 0:i.numberOfChannels,{width:h}=this.wavesurfer.getWrapper().getBoundingClientRect();o=s/h*a;let u=n.x/h*a,d=(n.x+5)/h*a;r=new S(Object.assign(Object.assign({},e),{start:u,end:d}),a,l),this.emit("region-initialized",r),r.element&&this.regionsContainer.appendChild(r.element)}else"move"===n.type&&void 0!==n.deltaX?r&&r._onUpdate(n.deltaX,n.x>s?"end":"start",o):"end"===n.type&&r&&(this.saveRegion(r),r.updatingSide=void 0,r=null)},[a.signal]);return()=>{l(),a.cleanup()}}clearRegions(){this.regions.slice().forEach(e=>e.remove()),this.regions=[]}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}constructor(e){super(e),this.regions=[],this.regionsContainer=this.initRegionsContainer()}}function P(e){var g;let{hiddenTime:f,hiddenVolumn:v,srcs:b,className:y,showProgressBar:x,...w}=e,C=(0,p.useRef)(null),S=(0,p.useRef)(null),[P,k]=(0,p.useState)(!1),[R,M]=(0,p.useState)(0),[D,L]=(0,p.useState)(0),[T,j]=(0,p.useState)(!0),[z,N]=(0,p.useState)(1),[W,A]=(0,p.useState)(!1),O=null!=(g=w.downloadButton)&&g;(0,p.useEffect)(()=>{if(!C.current)return;C.current.innerHTML="";let e=m.default.create({container:C.current,height:50,width:"100%",waveColor:"#0BE3F7",progressColor:"#0497EB",normalize:!0,plugins:[E.create()],hideScrollbar:!x,interact:!!x});S.current=e;let t=async()=>{j(!0);let t=await Promise.all(b.map(async e=>{let t=await fetch(e),i=await t.arrayBuffer();return new AudioContext().decodeAudioData(i)})),i=t.reduce((e,t)=>e+t.length,0),n=new AudioContext().createBuffer(t[0].numberOfChannels,i,t[0].sampleRate),r=0,s=[0];for(let e of t){for(let t=0;t<e.numberOfChannels;t++){let i=e.duration;s.push(s[s.length-1]+i),n.copyToChannel(e.getChannelData(t),t,r)}r+=e.length}let o=new ArrayBuffer(44+2*n.length),a=new DataView(o),l=(e,t,i)=>{for(let n=0;n<i.length;n++)e.setUint8(t+n,i.charCodeAt(n))};l(a,0,"RIFF"),a.setUint32(4,36+2*n.length,!0),l(a,8,"WAVE"),l(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,n.numberOfChannels,!0),a.setUint32(24,n.sampleRate,!0),a.setUint32(28,2*n.sampleRate,!0),a.setUint16(32,4,!0),a.setUint16(34,16,!0),l(a,36,"data"),a.setUint32(40,2*n.length,!0);let h=n.length,u=n.getChannelData(0),d=44;for(let e=0;e<h;e++){let t=Math.max(-1,Math.min(1,u[e]));a.setInt16(d,t<0?32768*t:32767*t,!0),d+=2}let c=new Blob([o],{type:"audio/wav"});e.empty(),await e.loadBlob(c);let p=e.getActivePlugins()[0];for(let e=1;e<s.length-1;e++){let t=s[e];p.addRegion({start:t,color:"red",drag:!1})}};L(0),M(0),k(!1),1===b.length?(e.empty(),e.load(b[0])):t(),e.on("ready",()=>{console.log("wavesurfer ready"),j(!1),L(e.getDuration())}),e.on("finish",()=>{k(!1)}),e.on("audioprocess",()=>{M(e.getCurrentTime())}),e.on("interaction",()=>{M(e.getCurrentTime()),_()})},[b,x]);let _=()=>{S.current&&(S.current.play(),k(!0))},H=e=>{"add"===e?N(e=>Math.min(e+.05,1)):N(e=>Math.max(e-.05,0)),S.current&&S.current.setVolume(z)},B="".concat((0,i.secondToStr)(R),"/").concat((0,i.secondToStr)(D)),I=()=>{var e,t;W?(A(!1),null==(e=S.current)||e.zoom(1)):(A(!0),null==(t=S.current)||t.zoom(50))};return(0,t.jsxs)("div",{className:(0,n.cn)("flex w-full flex-col gap-2",y),children:[(0,t.jsx)("div",{ref:C,className:"w-full max-w-[30vw] p-2"}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"mr-2 cursor-pointer",onClick:P?()=>{S.current&&(S.current.pause(),k(!1))}:_,"aria-label":P?"Pause":"Play",children:T?(0,t.jsx)(s.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):P?(0,t.jsx)(c.PauseIcon,{className:"h-5 w-5"}):(0,t.jsx)(c.PlayIcon,{className:"h-5 w-5"})}),!f&&(0,t.jsx)("div",{children:B})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[W?(0,t.jsx)(d.ZoomOut,{className:"h-5 w-5 cursor-pointer",onClick:I}):(0,t.jsx)(u.ZoomIn,{className:"h-5 w-5 cursor-pointer",onClick:I}),v?null:(0,t.jsxs)("div",{className:"group relative flex flex-col items-center",children:[(0,t.jsx)("div",{className:(0,n.cn)("absolute -left-0 -top-32 z-10 h-36 w-10 -translate-y-1 py-2","rounded-lg border bg-card text-card-foreground shadow transition-shadow duration-150 ease-in-out hover:shadow-lg","group-hover:block","hidden","hover:block","transition-all duration-500 ease-in-out"),children:(0,t.jsxs)("div",{className:"flex h-full w-full flex-col items-center gap-2",children:[(0,t.jsx)(a.Plus,{className:"h-4 w-4 cursor-pointer",onClick:()=>H("add")}),(0,t.jsx)(r.Slider,{value:[100*z],onValueChange:e=>{let t=e[0]/100;N(t),S.current&&S.current.setVolume(t)},max:100,min:0,orientation:"vertical",className:(0,n.cn)("flex-1 cursor-pointer")}),(0,t.jsx)(o.Minus,{className:"h-4 w-4 cursor-pointer",onClick:()=>H("minus")})]})}),(0,t.jsx)(h.Volume2,{className:"cursor-pointer"})]}),O&&1===b.length&&(0,t.jsx)(l.Download,{className:"h-5 w-5 cursor-pointer",onClick:()=>{1===b.length&&window.open(b[0],"_blank")}})]})]})]})}let k=function(e){let{src:l,className:u,hiddenTime:d,hiddenVolumn:m,...g}=e,f="string"!=typeof l,[v,b]=(0,p.useState)("-/-"),[y,x]=(0,p.useState)(0),w=(0,p.useRef)(null),[C,S]=(0,p.useState)(!0),{isPlaying:E,play:P,pause:k,volume:R,setVolume:M,duration:D,currentTime:L,changeCurrentTime:T}=(0,i.useAudioPlayController)(f?l:w.current,f);(0,p.useEffect)(()=>{-1!==D&&(b((0,i.secondToStr)(L)+"/"+(0,i.secondToStr)(D)),x(L/D*100))},[D,L]),(0,p.useEffect)(()=>{x(0)},[l]);let j=(e,t)=>{"add"===e?M(Math.min(t+5,100)):M(Math.max(t-5,0))};return(0,t.jsxs)("div",{className:(0,n.cn)("flex h-4 w-full items-center justify-between gap-3",u),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:E?k:P,children:C&&!f?(0,t.jsx)(s.Loader2,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(t.Fragment,{children:E?(0,t.jsx)(c.PauseIcon,{className:"h-4 w-4"}):(0,t.jsx)(c.PlayIcon,{className:"h-4 w-4"})})}),!d&&(0,t.jsx)("div",{className:"text-sm",children:v})]}),(0,t.jsx)("div",{className:"flex h-4 w-full items-center",children:(0,t.jsx)(r.Slider,{max:100,min:0,value:[y],onValueChange:e=>{if(-1===D)return;let t=e[0],i=t/100*D;x(t),T(i)},className:(0,n.cn)("h-2 w-[100%] cursor-pointer")})}),m?null:(0,t.jsxs)("div",{className:"group relative px-2 py-4",children:[(0,t.jsx)("div",{className:(0,n.cn)("absolute -left-0 -top-32 z-10 h-36 w-10 -translate-y-1 py-2","rounded-lg border bg-card text-card-foreground shadow transition-shadow duration-150 ease-in-out hover:shadow-lg","group-hover:block","hidden","hover:block","transition-all duration-500 ease-in-out"),children:(0,t.jsxs)("div",{className:"flex h-full w-full flex-col items-center gap-2",children:[(0,t.jsx)(a.Plus,{className:"h-4 w-4 cursor-pointer",onClick:()=>j("add",R)}),(0,t.jsx)(r.Slider,{value:[100*R],onValueChange:e=>{M(e[0]/100)},max:100,min:0,orientation:"vertical",className:(0,n.cn)("flex-1 cursor-pointer")}),(0,t.jsx)(o.Minus,{className:"h-4 w-4 cursor-pointer",onClick:()=>j("minus",R)})]})}),(0,t.jsx)(h.Volume2,{className:"cursor-pointer"})]}),!f&&(0,t.jsx)("audio",{className:"hidden",src:l,controls:!1,onCanPlayThrough:()=>S(!1),ref:w})]})}},472068,e=>{"use strict";e.s(["Slider",()=>I],472068);var t=e.i(843476),i=e.i(271645),n=e.i(470152),r=e.i(981140),s=e.i(820783),o=e.i(30030),a=e.i(369340),l=e.i(586318),h=e.i(999682),u=e.i(635804),d=e.i(248425),c=e.i(75830),p=["PageUp","PageDown"],m=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],g={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},f="Slider",[v,b,y]=(0,c.createCollection)(f),[x,w]=(0,o.createContextScope)(f,[y]),[C,S]=x(f),E=i.forwardRef((e,s)=>{let{name:o,min:l=0,max:h=100,step:u=1,orientation:d="horizontal",disabled:c=!1,minStepsBetweenThumbs:g=0,defaultValue:f=[l],value:b,onValueChange:y=()=>{},onValueCommit:x=()=>{},inverted:w=!1,form:S,...E}=e,P=i.useRef(new Set),k=i.useRef(0),D="horizontal"===d,[L=[],T]=(0,a.useControllableState)({prop:b,defaultProp:f,onChange:e=>{var t;null==(t=[...P.current][k.current])||t.focus(),y(e)}}),j=i.useRef(L);function z(e,t){let{commit:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{commit:!1},r=(String(u).split(".")[1]||"").length,s=function(e,t){let i=Math.pow(10,t);return Math.round(e*i)/i}(Math.round((e-l)/u)*u+l,r),o=(0,n.clamp)(s,[l,h]);T(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n=[...e];return n[i]=t,n.sort((e,t)=>e-t)}(e,o,t);if(!function(e,t){if(t>0)return Math.min(...e.slice(0,-1).map((t,i)=>e[i+1]-t))>=t;return!0}(n,g*u))return e;{k.current=n.indexOf(o);let t=String(n)!==String(e);return t&&i&&x(n),t?n:e}})}return(0,t.jsx)(C,{scope:e.__scopeSlider,name:o,disabled:c,min:l,max:h,valueIndexToChangeRef:k,thumbs:P.current,values:L,orientation:d,form:S,children:(0,t.jsx)(v.Provider,{scope:e.__scopeSlider,children:(0,t.jsx)(v.Slot,{scope:e.__scopeSlider,children:(0,t.jsx)(D?R:M,{"aria-disabled":c,"data-disabled":c?"":void 0,...E,ref:s,onPointerDown:(0,r.composeEventHandlers)(E.onPointerDown,()=>{c||(j.current=L)}),min:l,max:h,inverted:w,onSlideStart:c?void 0:function(e){let t=function(e,t){if(1===e.length)return 0;let i=e.map(e=>Math.abs(e-t)),n=Math.min(...i);return i.indexOf(n)}(L,e);z(e,t)},onSlideMove:c?void 0:function(e){z(e,k.current)},onSlideEnd:c?void 0:function(){let e=j.current[k.current];L[k.current]!==e&&x(L)},onHomeKeyDown:()=>!c&&z(l,0,{commit:!0}),onEndKeyDown:()=>!c&&z(h,L.length-1,{commit:!0}),onStepKeyDown:e=>{let{event:t,direction:i}=e;if(!c){let e=p.includes(t.key)||t.shiftKey&&m.includes(t.key),n=k.current;z(L[n]+u*(e?10:1)*i,n,{commit:!0})}}})})})})});E.displayName=f;var[P,k]=x(f,{startEdge:"left",endEdge:"right",size:"width",direction:1}),R=i.forwardRef((e,n)=>{let{min:r,max:o,dir:a,inverted:h,onSlideStart:u,onSlideMove:d,onSlideEnd:c,onStepKeyDown:p,...m}=e,[f,v]=i.useState(null),b=(0,s.useComposedRefs)(n,e=>v(e)),y=i.useRef(void 0),x=(0,l.useDirection)(a),w="ltr"===x,C=w&&!h||!w&&h;function S(e){let t=y.current||f.getBoundingClientRect(),i=H([0,t.width],C?[r,o]:[o,r]);return y.current=t,i(e-t.left)}return(0,t.jsx)(P,{scope:e.__scopeSlider,startEdge:C?"left":"right",endEdge:C?"right":"left",direction:C?1:-1,size:"width",children:(0,t.jsx)(D,{dir:x,"data-orientation":"horizontal",...m,ref:b,style:{...m.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{let t=S(e.clientX);null==u||u(t)},onSlideMove:e=>{let t=S(e.clientX);null==d||d(t)},onSlideEnd:()=>{y.current=void 0,null==c||c()},onStepKeyDown:e=>{let t=g[C?"from-left":"from-right"].includes(e.key);null==p||p({event:e,direction:t?-1:1})}})})}),M=i.forwardRef((e,n)=>{let{min:r,max:o,inverted:a,onSlideStart:l,onSlideMove:h,onSlideEnd:u,onStepKeyDown:d,...c}=e,p=i.useRef(null),m=(0,s.useComposedRefs)(n,p),f=i.useRef(void 0),v=!a;function b(e){let t=f.current||p.current.getBoundingClientRect(),i=H([0,t.height],v?[o,r]:[r,o]);return f.current=t,i(e-t.top)}return(0,t.jsx)(P,{scope:e.__scopeSlider,startEdge:v?"bottom":"top",endEdge:v?"top":"bottom",size:"height",direction:v?1:-1,children:(0,t.jsx)(D,{"data-orientation":"vertical",...c,ref:m,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{let t=b(e.clientY);null==l||l(t)},onSlideMove:e=>{let t=b(e.clientY);null==h||h(t)},onSlideEnd:()=>{f.current=void 0,null==u||u()},onStepKeyDown:e=>{let t=g[v?"from-bottom":"from-top"].includes(e.key);null==d||d({event:e,direction:t?-1:1})}})})}),D=i.forwardRef((e,i)=>{let{__scopeSlider:n,onSlideStart:s,onSlideMove:o,onSlideEnd:a,onHomeKeyDown:l,onEndKeyDown:h,onStepKeyDown:u,...c}=e,g=S(f,n);return(0,t.jsx)(d.Primitive.span,{...c,ref:i,onKeyDown:(0,r.composeEventHandlers)(e.onKeyDown,e=>{"Home"===e.key?(l(e),e.preventDefault()):"End"===e.key?(h(e),e.preventDefault()):p.concat(m).includes(e.key)&&(u(e),e.preventDefault())}),onPointerDown:(0,r.composeEventHandlers)(e.onPointerDown,e=>{let t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),g.thumbs.has(t)?t.focus():s(e)}),onPointerMove:(0,r.composeEventHandlers)(e.onPointerMove,e=>{e.target.hasPointerCapture(e.pointerId)&&o(e)}),onPointerUp:(0,r.composeEventHandlers)(e.onPointerUp,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),a(e))})})}),L="SliderTrack",T=i.forwardRef((e,i)=>{let{__scopeSlider:n,...r}=e,s=S(L,n);return(0,t.jsx)(d.Primitive.span,{"data-disabled":s.disabled?"":void 0,"data-orientation":s.orientation,...r,ref:i})});T.displayName=L;var j="SliderRange",z=i.forwardRef((e,n)=>{let{__scopeSlider:r,...o}=e,a=S(j,r),l=k(j,r),h=i.useRef(null),u=(0,s.useComposedRefs)(n,h),c=a.values.length,p=a.values.map(e=>_(e,a.min,a.max)),m=c>1?Math.min(...p):0,g=100-Math.max(...p);return(0,t.jsx)(d.Primitive.span,{"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,...o,ref:u,style:{...e.style,[l.startEdge]:m+"%",[l.endEdge]:g+"%"}})});z.displayName=j;var N="SliderThumb",W=i.forwardRef((e,n)=>{let r=b(e.__scopeSlider),[o,a]=i.useState(null),l=(0,s.useComposedRefs)(n,e=>a(e)),h=i.useMemo(()=>o?r().findIndex(e=>e.ref.current===o):-1,[r,o]);return(0,t.jsx)(A,{...e,ref:l,index:h})}),A=i.forwardRef((e,n)=>{let{__scopeSlider:o,index:a,name:l,...h}=e,c=S(N,o),p=k(N,o),[m,g]=i.useState(null),f=(0,s.useComposedRefs)(n,e=>g(e)),b=!m||c.form||!!m.closest("form"),y=(0,u.useSize)(m),x=c.values[a],w=void 0===x?0:_(x,c.min,c.max),C=function(e,t){return t>2?"Value ".concat(e+1," of ").concat(t):2===t?["Minimum","Maximum"][e]:void 0}(a,c.values.length),E=null==y?void 0:y[p.size],P=E?function(e,t,i){let n=e/2,r=H([0,50],[0,n]);return(n-r(t)*i)*i}(E,w,p.direction):0;return i.useEffect(()=>{if(m)return c.thumbs.add(m),()=>{c.thumbs.delete(m)}},[m,c.thumbs]),(0,t.jsxs)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[p.startEdge]:"calc(".concat(w,"% + ").concat(P,"px)")},children:[(0,t.jsx)(v.ItemSlot,{scope:e.__scopeSlider,children:(0,t.jsx)(d.Primitive.span,{role:"slider","aria-label":e["aria-label"]||C,"aria-valuemin":c.min,"aria-valuenow":x,"aria-valuemax":c.max,"aria-orientation":c.orientation,"data-orientation":c.orientation,"data-disabled":c.disabled?"":void 0,tabIndex:c.disabled?void 0:0,...h,ref:f,style:void 0===x?{display:"none"}:e.style,onFocus:(0,r.composeEventHandlers)(e.onFocus,()=>{c.valueIndexToChangeRef.current=a})})}),b&&(0,t.jsx)(O,{name:null!=l?l:c.name?c.name+(c.values.length>1?"[]":""):void 0,form:c.form,value:x},a)]})});W.displayName=N;var O=i.forwardRef((e,n)=>{let{__scopeSlider:r,value:o,...a}=e,l=i.useRef(null),u=(0,s.useComposedRefs)(l,n),c=(0,h.usePrevious)(o);return i.useEffect(()=>{let e=l.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set;if(c!==o&&t){let i=new Event("input",{bubbles:!0});t.call(e,o),e.dispatchEvent(i)}},[c,o]),(0,t.jsx)(d.Primitive.input,{style:{display:"none"},...a,ref:u,defaultValue:o})});function _(e,t,i){return(0,n.clamp)(100/(i-t)*(e-t),[0,100])}function H(e,t){return i=>{if(e[0]===e[1]||t[0]===t[1])return t[0];let n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(i-e[0])}}O.displayName="RadioBubbleInput";var B=e.i(647163);let I=i.forwardRef((e,n)=>{var r,s,o,a,l,h;let{className:u,showValueTooltip:d,formatValue:c,...p}=e,[m,g]=i.useState(!1),f=(0,t.jsxs)(E,{ref:n,className:(0,B.cn)("relative flex w-full touch-none select-none items-center","data-[orientation=vertical]:flex-col","data-[orientation=vertical]:w-1.5",u),...p,children:[(0,t.jsx)(T,{"data-slot":"track",className:(0,B.cn)("relative h-1.5 w-full grow overflow-hidden rounded-full bg-secondary","data-[orientation=vertical]:h-full","data-[orientation=vertical]:w-1.5"),children:(0,t.jsx)(z,{"data-slot":"range",className:(0,B.cn)("absolute h-full bg-primary","data-[orientation=vertical]:w-full")})}),(0,t.jsx)(W,{"data-slot":"thumb",className:"block h-3 w-3 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]});if(!d)return f;let v=null!=(a=null!=(o=null==(r=p.value)?void 0:r[0])?o:null==(s=p.defaultValue)?void 0:s[0])?a:0,b=null!=(l=p.min)?l:0,y=null!=(h=p.max)?h:100,x=Math.max(8,Math.min(92,y>b?(v-b)/(y-b)*100:0));return(0,t.jsxs)("div",{className:"relative min-w-0 flex-1 overflow-visible",onPointerDown:()=>g(!0),onPointerUp:()=>g(!1),onPointerLeave:()=>g(!1),children:[f,m&&(0,t.jsx)("div",{className:"pointer-events-none absolute -top-8 z-50 -translate-x-1/2 whitespace-nowrap rounded bg-popover px-2 py-1 font-mono text-xs tabular-nums shadow-md duration-100 animate-in fade-in-0 zoom-in-95",style:{left:"".concat(x,"%")},children:c?c(v):String(v)})]})});I.displayName=E.displayName},500187,e=>{"use strict";e.s(["default",()=>t]);let t=(0,e.i(475254).default)("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]])},554212,e=>{"use strict";e.s(["ZoomIn",()=>t.default]);var t=e.i(500187)},363689,e=>{"use strict";e.s(["default",()=>t]);let t=(0,e.i(475254).default)("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]])},520354,e=>{"use strict";e.s(["ZoomOut",()=>t.default]);var t=e.i(363689)},299023,642310,e=>{"use strict";e.s(["Minus",()=>t],299023),e.s(["default",()=>t],642310);let t=(0,e.i(475254).default)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},946858,e=>{"use strict";function t(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})}e.s(["default",()=>x]),"function"==typeof SuppressedError&&SuppressedError;class i{on(e,t,i){if(this.listeners[e]||(this.listeners[e]=new Set),null==i?void 0:i.once){var n=this;let i=function(){for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];n.un(e,i),t(...s)};return this.listeners[e].add(i),()=>this.un(e,i)}return this.listeners[e].add(t),()=>this.un(e,t)}un(e,t){var i;null==(i=this.listeners[e])||i.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.listeners[e]&&this.listeners[e].forEach(e=>e(...i))}constructor(){this.listeners={}}}let n={decode:function(e,i){return t(this,void 0,void 0,function*(){let t=new AudioContext({sampleRate:i});try{return yield t.decodeAudioData(e)}finally{t.close()}})},createBuffer:function(e,t){if(!e||0===e.length)throw Error("channelData must be a non-empty array");if(t<=0)throw Error("duration must be greater than 0");if("number"==typeof e[0]&&(e=[e]),!e[0]||0===e[0].length)throw Error("channelData must contain non-empty channel arrays");!function(e){let t=e[0];if(t.some(e=>e>1||e<-1)){let i=t.length,n=0;for(let e=0;e<i;e++){let i=Math.abs(t[e]);i>n&&(n=i)}for(let t of e)for(let e=0;e<i;e++)t[e]/=n}}(e);let i=e.map(e=>e instanceof Float32Array?e:Float32Array.from(e));return{duration:t,length:i[0].length,sampleRate:i[0].length/t,numberOfChannels:i.length,getChannelData:e=>{let t=i[e];if(!t)throw Error("Channel ".concat(e," not found"));return t},copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function r(e,t,i){let n=function e(t,i){let n=i.xmlns?document.createElementNS(i.xmlns,t):document.createElement(t);for(let[t,r]of Object.entries(i))if("children"===t&&r)for(let[t,i]of Object.entries(r))i instanceof Node?n.appendChild(i):"string"==typeof i?n.appendChild(document.createTextNode(i)):n.appendChild(e(t,i));else"style"===t?Object.assign(n.style,r):"textContent"===t?n.textContent=r:n.setAttribute(t,r.toString());return n}(e,t||{});return null==i||i.appendChild(n),n}var s=Object.freeze({__proto__:null,createElement:r,default:r});let o={fetchBlob:function(e,i,n){return t(this,void 0,void 0,function*(){let r=yield fetch(e,n);if(r.status>=400)throw Error("Failed to fetch ".concat(e,": ").concat(r.status," (").concat(r.statusText,")"));return function(e,i){t(this,void 0,void 0,function*(){if(!e.body||!e.headers)return;let t=e.body.getReader(),n=Number(e.headers.get("Content-Length"))||0,r=0,s=e=>{i(Math.round((r+=(null==e?void 0:e.length)||0)/n*100))};try{for(;;){let e=yield t.read();if(e.done)break;s(e.value)}}catch(e){console.warn("Progress tracking error:",e)}})}(r.clone(),i),r.blob()})}};function a(e){let t=e,i=new Set;return{get value(){return t},set(e){Object.is(t,e)||(t=e,i.forEach(e=>e(t)))},update(e){this.set(e(t))},subscribe:e=>(i.add(e),()=>i.delete(e))}}function l(e,t){let i=a(e());return t.forEach(t=>t.subscribe(()=>{let t=e();Object.is(i.value,t)||i.set(t)})),{get value(){return i.value},subscribe:e=>i.subscribe(e)}}function h(e,t){let i,n=()=>{i&&(i(),i=void 0),i=e()},r=t.map(e=>e.subscribe(n));return n(),()=>{i&&(i(),i=void 0),r.forEach(e=>e())}}class u extends i{get isPlayingSignal(){return this._isPlaying}get currentTimeSignal(){return this._currentTime}get durationSignal(){return this._duration}get volumeSignal(){return this._volume}get mutedSignal(){return this._muted}get playbackRateSignal(){return this._playbackRate}get seekingSignal(){return this._seeking}setupReactiveMediaEvents(){this.reactiveMediaEventCleanups.push(this.onMediaEvent("play",()=>{this._isPlaying.set(!0)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("pause",()=>{this._isPlaying.set(!1)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("ended",()=>{this._isPlaying.set(!1)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("timeupdate",()=>{this._currentTime.set(this.media.currentTime)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("durationchange",()=>{this._duration.set(this.media.duration||0)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("loadedmetadata",()=>{this._duration.set(this.media.duration||0)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("seeking",()=>{this._seeking.set(!0)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("seeked",()=>{this._seeking.set(!1)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("volumechange",()=>{this._volume.set(this.media.volume),this._muted.set(this.media.muted)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("ratechange",()=>{this._playbackRate.set(this.media.playbackRate)}))}onMediaEvent(e,t,i){return this.media.addEventListener(e,t,i),()=>this.media.removeEventListener(e,t,i)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){let e=this.getSrc();e.startsWith("blob:")&&URL.revokeObjectURL(e)}canPlayType(e){return""!==this.media.canPlayType(e)}setSrc(e,t){let i=this.getSrc();if(e&&i===e)return;this.revokeSrc();let n=t instanceof Blob&&(this.canPlayType(t.type)||!e)?URL.createObjectURL(t):e;if(i&&this.media.removeAttribute("src"),n||e)try{this.media.src=n}catch(t){this.media.src=e}}destroy(){this.reactiveMediaEventCleanups.forEach(e=>e()),this.reactiveMediaEventCleanups=[],this.isExternalMedia||(this.media.pause(),this.revokeSrc(),this.media.removeAttribute("src"),this.media.load(),this.media.remove())}setMediaElement(e){this.reactiveMediaEventCleanups.forEach(e=>e()),this.reactiveMediaEventCleanups=[],this.media=e,this.setupReactiveMediaEvents()}play(){return t(this,void 0,void 0,function*(){try{return yield this.media.play()}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return;throw e}})}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(e){this.media.currentTime=Math.max(0,Math.min(e,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(e){this.media.volume=e}getMuted(){return this.media.muted}setMuted(e){this.media.muted=e}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(e,t){null!=t&&(this.media.preservesPitch=t),this.media.playbackRate=e}getMediaElement(){return this.media}setSinkId(e){return this.media.setSinkId(e)}constructor(e){super(),this.isExternalMedia=!1,this.reactiveMediaEventCleanups=[],e.media?(this.media=e.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),this._isPlaying=a(!1),this._currentTime=a(0),this._duration=a(0),this._volume=a(this.media.volume),this._muted=a(this.media.muted),this._playbackRate=a(this.media.playbackRate||1),this._seeking=a(!1),this.setupReactiveMediaEvents(),e.mediaControls&&(this.media.controls=!0),e.autoplay&&(this.media.autoplay=!0),null!=e.playbackRate&&this.onMediaEvent("canplay",()=>{null!=e.playbackRate&&(this.media.playbackRate=e.playbackRate)},{once:!0})}}function d(e,t,i){let n=t-e.left,r=i-e.top;return[n/e.width,r/e.height]}function c(e){return!!(e.barWidth||e.barGap||e.barAlign)}function p(e,t){if(!c(t))return e;let i=t.barWidth||.5,n=i+(t.barGap||i/2);return 0===n?e:Math.floor(e/n)*n}function m(e){let{scrollLeft:t,totalWidth:i,numCanvases:n}=e;if(0===i)return[0];let r=Math.floor(t/i*n);return[r-1,r,r+1]}function g(e){let t=e._cleanup;"function"==typeof t&&t()}class f extends i{parentFromOptionsContainer(e){let t;if("string"==typeof e?t=document.querySelector(e):e instanceof HTMLElement&&(t=e),!t)throw Error("Container not found");return t}initEvents(){this.wrapper.addEventListener("click",e=>{let[t,i]=d(this.wrapper.getBoundingClientRect(),e.clientX,e.clientY);this.emit("click",t,i)}),this.wrapper.addEventListener("dblclick",e=>{let[t,i]=d(this.wrapper.getBoundingClientRect(),e.clientX,e.clientY);this.emit("dblclick",t,i)}),!0!==this.options.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.scrollStream=function(e){let t=a({scrollLeft:e.scrollLeft,scrollWidth:e.scrollWidth,clientWidth:e.clientWidth}),i=l(()=>(function(e){let{scrollLeft:t,scrollWidth:i,clientWidth:n}=e;return 0===i?{startX:0,endX:1}:{startX:Math.max(0,Math.min(1,t/i)),endX:Math.max(0,Math.min(1,(t+n)/i))}})(t.value),[t]),n=l(()=>{var e;return{left:(e=t.value).scrollLeft,right:e.scrollLeft+e.clientWidth}},[t]),r=()=>{t.set({scrollLeft:e.scrollLeft,scrollWidth:e.scrollWidth,clientWidth:e.clientWidth})};return e.addEventListener("scroll",r,{passive:!0}),{scrollData:t,percentages:i,bounds:n,cleanup:()=>{e.removeEventListener("scroll",r),g(t)}}}(this.scrollContainer);let e=h(()=>{let{startX:e,endX:t}=this.scrollStream.percentages.value,{left:i,right:n}=this.scrollStream.bounds.value;this.emit("scroll",e,t,i,n)},[this.scrollStream.percentages,this.scrollStream.bounds]);if(this.subscriptions.push(e),"function"==typeof ResizeObserver){let e=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{e().then(()=>this.onContainerResize()).catch(()=>{})}),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){let e=this.parent.clientWidth;e===this.lastContainerWidth&&"auto"!==this.options.height||(this.lastContainerWidth=e,this.reRender(),this.emit("resize"))}initDrag(){if(this.dragStream)return;this.dragStream=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{threshold:i=3,mouseButton:n=0,touchDelay:r=100}=t,s=a(null),o=new Map,l=matchMedia("(pointer: coarse)").matches,h=()=>{},u=t=>{if(t.button!==n||(o.set(t.pointerId,t),o.size>1))return;let a=t.clientX,u=t.clientY,d=!1,c=Date.now(),{left:p,top:m}=e.getBoundingClientRect(),g=e=>{if(e.defaultPrevented||o.size>1||l&&Date.now()-c<r)return;let t=e.clientX,n=e.clientY,h=t-a,g=n-u;(d||Math.abs(h)>i||Math.abs(g)>i)&&(e.preventDefault(),e.stopPropagation(),d||(s.set({type:"start",x:a-p,y:u-m}),d=!0),s.set({type:"move",x:t-p,y:n-m,deltaX:h,deltaY:g}),a=t,u=n)},f=e=>{if(o.delete(e.pointerId),d){let t=e.clientX,i=e.clientY;s.set({type:"end",x:t-p,y:i-m})}h()},v=e=>{o.delete(e.pointerId),e.relatedTarget&&e.relatedTarget!==document.documentElement||f(e)},b=e=>{d&&(e.stopPropagation(),e.preventDefault())},y=e=>{e.defaultPrevented||o.size>1||d&&e.preventDefault()};document.addEventListener("pointermove",g),document.addEventListener("pointerup",f),document.addEventListener("pointerout",v),document.addEventListener("pointercancel",v),document.addEventListener("touchmove",y,{passive:!1}),document.addEventListener("click",b,{capture:!0}),h=()=>{document.removeEventListener("pointermove",g),document.removeEventListener("pointerup",f),document.removeEventListener("pointerout",v),document.removeEventListener("pointercancel",v),document.removeEventListener("touchmove",y),setTimeout(()=>{document.removeEventListener("click",b,{capture:!0})},10)}};return e.addEventListener("pointerdown",u),{signal:s,cleanup:()=>{h(),e.removeEventListener("pointerdown",u),o.clear(),g(s)}}}(this.wrapper);let e=h(()=>{var e;let t=this.dragStream.signal.value;if(!t)return;let i=this.wrapper.getBoundingClientRect().width,n=(e=t.x/i)<0?0:e>1?1:e;"start"===t.type?(this.isDragging=!0,this.emit("dragstart",n)):"move"===t.type?this.emit("drag",n):"end"===t.type&&(this.isDragging=!1,this.emit("dragend",n))},[this.dragStream.signal]);this.subscriptions.push(e)}initHtml(){let e=document.createElement("div"),t=e.attachShadow({mode:"open"}),i=this.options.cspNonce&&"string"==typeof this.options.cspNonce?this.options.cspNonce.replace(/"/g,""):"";return t.innerHTML="\n      <style".concat(i?' nonce="'.concat(i,'"'):"",">\n        :host {\n          user-select: none;\n          min-width: 1px;\n        }\n        :host audio {\n          display: block;\n          width: 100%;\n        }\n        :host .scroll {\n          overflow-x: auto;\n          overflow-y: hidden;\n          width: 100%;\n          position: relative;\n        }\n        :host .noScrollbar {\n          scrollbar-color: transparent;\n          scrollbar-width: none;\n        }\n        :host .noScrollbar::-webkit-scrollbar {\n          display: none;\n          -webkit-appearance: none;\n        }\n        :host .wrapper {\n          position: relative;\n          overflow: visible;\n          z-index: 2;\n        }\n        :host .canvases {\n          min-height: ").concat(this.getHeight(this.options.height,this.options.splitChannels),'px;\n          pointer-events: none;\n        }\n        :host .canvases > div {\n          position: relative;\n        }\n        :host canvas {\n          display: block;\n          position: absolute;\n          top: 0;\n          image-rendering: pixelated;\n        }\n        :host .progress {\n          pointer-events: none;\n          position: absolute;\n          z-index: 2;\n          top: 0;\n          left: 0;\n          width: 0;\n          height: 100%;\n          overflow: hidden;\n        }\n        :host .progress > div {\n          position: relative;\n        }\n        :host .cursor {\n          pointer-events: none;\n          position: absolute;\n          z-index: 5;\n          top: 0;\n          left: 0;\n          height: 100%;\n          border-radius: 2px;\n        }\n      </style>\n\n      <div class="scroll" part="scroll">\n        <div class="wrapper" part="wrapper">\n          <div class="canvases" part="canvases"></div>\n          <div class="progress" part="progress"></div>\n          <div class="cursor" part="cursor"></div>\n        </div>\n      </div>\n    '),[e,t]}setOptions(e){if(this.options.container!==e.container){let t=this.parentFromOptionsContainer(e.container);t.appendChild(this.container),this.parent=t}!0!==e.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.options=e,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(e){this.scrollContainer.scrollLeft=e}setScrollPercentage(e){let{scrollWidth:t}=this.scrollContainer;this.setScroll(t*e)}destroy(){var e;this.subscriptions.forEach(e=>e()),this.container.remove(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),null==(e=this.unsubscribeOnScroll)||e.forEach(e=>e()),this.unsubscribeOnScroll=[],this.dragStream&&(this.dragStream.cleanup(),this.dragStream=null),this.scrollStream&&(this.scrollStream.cleanup(),this.scrollStream=null)}createDelay(){let e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=()=>{e&&(clearTimeout(e),e=void 0),t&&(t(),t=void 0)};return this.timeouts.push(n),()=>new Promise((r,s)=>{n(),t=s,e=setTimeout(()=>{e=void 0,t=void 0,r()},i)})}getHeight(e,t){var i;let n=(null==(i=this.audioData)?void 0:i.numberOfChannels)||1;return function(e){let{optionsHeight:t,optionsSplitChannels:i,parentHeight:n,numberOfChannels:r,defaultHeight:s=128}=e;if(null==t)return s;let o=Number(t);if(!isNaN(o))return o;if("auto"===t){let e=n||s;return(null==i?void 0:i.every(e=>!e.overlay))?e/r:e}return s}({optionsHeight:e,optionsSplitChannels:t,parentHeight:this.parent.clientHeight,numberOfChannels:n,defaultHeight:128})}convertColorValues(e,t){return function(e,t,i){if(!Array.isArray(e))return e||"";if(0===e.length)return"#999";if(e.length<2)return e[0]||"";let n=document.createElement("canvas"),r=n.getContext("2d"),s=null!=i?i:n.height*t,o=r.createLinearGradient(0,0,0,s||t),a=1/(e.length-1);return e.forEach((e,t)=>{o.addColorStop(t*a,e)}),o}(e,this.getPixelRatio(),null==t?void 0:t.canvas.height)}getPixelRatio(){return Math.max(1,window.devicePixelRatio||1)}renderBarWaveform(e,t,i,n){let{width:r,height:s}=i.canvas,{halfHeight:o,barWidth:a,barRadius:l,barIndexScale:h,barSpacing:u,barMinHeight:d}=function(e){let{width:t,height:i,length:n,options:r,pixelRatio:s}=e,o=r.barWidth?r.barWidth*s:1,a=r.barGap?r.barGap*s:r.barWidth?o/2:0,l=o+a||1;return{halfHeight:i/2,barWidth:o,barGap:a,barRadius:r.barRadius||0,barMinHeight:r.barMinHeight?r.barMinHeight*s:0,barIndexScale:n>0?t/l/n:0,barSpacing:l}}({width:r,height:s,length:(e[0]||[]).length,options:t,pixelRatio:this.getPixelRatio()}),c=function(e){let{channelData:t,barIndexScale:i,barSpacing:n,barWidth:r,halfHeight:s,vScale:o,canvasHeight:a,barAlign:l,barMinHeight:h}=e,u=t[0]||[],d=t[1]||u,c=u.length,p=[],m=0,g=0,f=0;for(let e=0;e<=c;e++){let t=Math.round(e*i);if(t>m){let{topHeight:e,totalHeight:i}=function(e){let{maxTop:t,maxBottom:i,halfHeight:n,vScale:r,barMinHeight:s=0,barAlign:o}=e,a=Math.round(t*n*r),l=a+Math.round(i*n*r)||1;return l<s&&(l=s,o||(a=l/2)),{topHeight:a,totalHeight:l}}({maxTop:g,maxBottom:f,halfHeight:s,vScale:o,barMinHeight:h,barAlign:l}),u=function(e){let{barAlign:t,halfHeight:i,topHeight:n,totalHeight:r,canvasHeight:s}=e;return"top"===t?0:"bottom"===t?s-r:i-n}({barAlign:l,halfHeight:s,topHeight:e,totalHeight:i,canvasHeight:a});p.push({x:m*n,y:u,width:r,height:i}),m=t,g=0,f=0}let c=Math.abs(u[e]||0),v=Math.abs(d[e]||0);c>g&&(g=c),v>f&&(f=v)}return p}({channelData:e,barIndexScale:h,barSpacing:u,barWidth:a,halfHeight:o,vScale:n,canvasHeight:s,barAlign:t.barAlign,barMinHeight:d});for(let e of(i.beginPath(),c))l&&"roundRect"in i?i.roundRect(e.x,e.y,e.width,e.height,l):i.rect(e.x,e.y,e.width,e.height);i.fill(),i.closePath()}renderLineWaveform(e,t,i,n){let{width:r,height:s}=i.canvas,o=function(e){let{channelData:t,width:i,height:n,vScale:r}=e,s=n/2,o=t[0]||[];return[o,t[1]||o].map((e,t)=>{let n=e.length,o=n?i/n:0,a=0===t?-1:1,l=[{x:0,y:s}],h=0,u=0;for(let t=0;t<=n;t++){let i=Math.round(t*o);if(i>h){let e=s+(Math.round(u*s*r)||1)*a;l.push({x:h,y:e}),h=i,u=0}let n=Math.abs(e[t]||0);n>u&&(u=n)}return l.push({x:h,y:s}),l})}({channelData:e,width:r,height:s,vScale:n});for(let e of(i.beginPath(),o))if(e.length){i.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++){let n=e[t];i.lineTo(n.x,n.y)}}i.fill(),i.closePath()}renderWaveform(e,t,i){if(i.fillStyle=this.convertColorValues(t.waveColor,i),t.renderFunction)return void t.renderFunction(e,i);let n=function(e){var t;let{channelData:i,barHeight:n,normalize:r,maxPeak:s}=e,o=n||1;if(!r)return o;let a=i[0];if(!a||0===a.length)return o;let l=null!=s?s:0;if(!s)for(let e=0;e<a.length;e++){let i=Math.abs(null!=(t=a[e])?t:0);i>l&&(l=i)}return l?o/l:o}({channelData:e,barHeight:t.barHeight,normalize:t.normalize,maxPeak:t.maxPeak});c(t)?this.renderBarWaveform(e,t,i,n):this.renderLineWaveform(e,t,i,n)}renderSingleCanvas(e,t,i,n,r,s,o){let a=this.getPixelRatio(),l=document.createElement("canvas");l.width=Math.round(i*a),l.height=Math.round(n*a),l.style.width="".concat(i,"px"),l.style.height="".concat(n,"px"),l.style.left="".concat(Math.round(r),"px"),s.appendChild(l);let h=l.getContext("2d");if(t.renderFunction?(h.fillStyle=this.convertColorValues(t.waveColor,h),t.renderFunction(e,h)):this.renderWaveform(e,t,h),l.width>0&&l.height>0){let e=l.cloneNode(),i=e.getContext("2d");i.drawImage(l,0,0),i.globalCompositeOperation="source-in",i.fillStyle=this.convertColorValues(t.progressColor,i),i.fillRect(0,0,l.width,l.height),o.appendChild(e)}}renderMultiCanvas(e,t,i,n,r,s){let o=this.getPixelRatio(),{clientWidth:a}=this.scrollContainer,l=i/o,h=function(e){let{clientWidth:t,totalWidth:i,options:n}=e;return p(Math.min(8e3,t,i),n)}({clientWidth:a,totalWidth:l,options:t}),u={};if(0===h)return;let d=i=>{if(i<0||i>=c||u[i])return;u[i]=!0;let o=i*h,a=Math.min(l-o,h);if((a=p(a,t))<=0)return;let d=function(e){let{channelData:t,offset:i,clampedWidth:n,totalWidth:r}=e;return t.map(e=>{let t=Math.floor(i/r*e.length),s=Math.floor((i+n)/r*e.length);return e.slice(t,s)})}({channelData:e,offset:o,clampedWidth:a,totalWidth:l});this.renderSingleCanvas(d,t,a,n,o,r,s)},c=Math.ceil(l/h);if(!this.isScrollable){for(let e=0;e<c;e++)d(e);return}if(m({scrollLeft:this.scrollContainer.scrollLeft,totalWidth:l,numCanvases:c}).forEach(e=>d(e)),c>1){let e=this.on("scroll",()=>{let{scrollLeft:e}=this.scrollContainer;Object.keys(u).length>10&&(r.innerHTML="",s.innerHTML="",u={}),m({scrollLeft:e,totalWidth:l,numCanvases:c}).forEach(e=>d(e))});this.unsubscribeOnScroll.push(e)}}renderChannel(e,t,i,n){var{overlay:r}=t,s=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)0>t.indexOf(n[r])&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}(t,["overlay"]);let o=document.createElement("div"),a=this.getHeight(s.height,s.splitChannels);o.style.height="".concat(a,"px"),r&&n>0&&(o.style.marginTop="-".concat(a,"px")),this.canvasWrapper.style.minHeight="".concat(a,"px"),this.canvasWrapper.appendChild(o);let l=o.cloneNode();this.progressWrapper.appendChild(l),this.renderMultiCanvas(e,s,i,a,o,l)}render(e){return t(this,void 0,void 0,function*(){var t;this.timeouts.forEach(e=>e()),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",null!=this.options.width&&(this.scrollContainer.style.width="number"==typeof this.options.width?"".concat(this.options.width,"px"):this.options.width);let i=this.getPixelRatio(),n=this.scrollContainer.clientWidth,{scrollWidth:r,isScrollable:s,useParentWidth:o,width:a}=function(e){let{duration:t,minPxPerSec:i=0,parentWidth:n,fillParent:r,pixelRatio:s}=e,o=Math.ceil(t*i),a=o>n,l=!!(r&&!a);return{scrollWidth:o,isScrollable:a,useParentWidth:l,width:(l?n:o)*s}}({duration:e.duration,minPxPerSec:this.options.minPxPerSec||0,parentWidth:n,fillParent:this.options.fillParent,pixelRatio:i});if(this.isScrollable=s,this.wrapper.style.width=o?"100%":"".concat(r,"px"),this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor="".concat(this.options.cursorColor||this.options.progressColor),this.cursor.style.width="".concat(this.options.cursorWidth,"px"),this.audioData=e,this.emit("render"),this.options.splitChannels)for(let i=0;i<e.numberOfChannels;i++){let n=Object.assign(Object.assign({},this.options),null==(t=this.options.splitChannels)?void 0:t[i]);this.renderChannel([e.getChannelData(i)],n,a,i)}else{let t=[e.getChannelData(0)];e.numberOfChannels>1&&t.push(e.getChannelData(1)),this.renderChannel(t,this.options,a,0)}Promise.resolve().then(()=>this.emit("rendered"))})}reRender(){if(this.unsubscribeOnScroll.forEach(e=>e()),this.unsubscribeOnScroll=[],!this.audioData)return;let{scrollWidth:e}=this.scrollContainer,{right:t}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&e!==this.scrollContainer.scrollWidth){let{right:e}=this.progressWrapper.getBoundingClientRect(),i=function(e){let t=2*e;return(t<0?Math.floor(t):Math.ceil(t))/2}(e-t);this.scrollContainer.scrollLeft+=i}}zoom(e){this.options.minPxPerSec=e,this.reRender()}scrollIntoView(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{scrollLeft:i,scrollWidth:n,clientWidth:r}=this.scrollContainer,s=e*n,o=i+r,a=r/2;if(this.isDragging)s+30>o?this.scrollContainer.scrollLeft+=30:s-30<i&&(this.scrollContainer.scrollLeft-=30);else{(s<i||s>o)&&(this.scrollContainer.scrollLeft=s-(this.options.autoCenter?a:0));let e=s-i-a;t&&this.options.autoCenter&&e>0&&(this.scrollContainer.scrollLeft+=e)}}renderProgress(e,t){if(isNaN(e))return;let i=100*e;this.canvasWrapper.style.clipPath="polygon(".concat(i,"% 0%, 100% 0%, 100% 100%, ").concat(i,"% 100%)"),this.progressWrapper.style.width="".concat(i,"%"),this.cursor.style.left="".concat(i,"%"),this.cursor.style.transform=this.options.cursorWidth?"translateX(-".concat(e*this.options.cursorWidth,"px)"):"",this.isScrollable&&this.options.autoScroll&&this.audioData&&this.audioData.duration>0&&this.scrollIntoView(e,t)}exportImage(e,i,n){return t(this,void 0,void 0,function*(){let t=this.canvasWrapper.querySelectorAll("canvas");if(!t.length)throw Error("No waveform data");return"dataURL"===n?Promise.resolve(Array.from(t).map(t=>t.toDataURL(e,i))):Promise.all(Array.from(t).map(t=>new Promise((n,r)=>{t.toBlob(e=>{e?n(e):r(Error("Could not export image"))},e,i)})))})}constructor(e,t){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.dragStream=null,this.scrollStream=null,this.subscriptions=[],this.options=e;let i=this.parentFromOptionsContainer(e.container);this.parent=i;let[n,r]=this.initHtml();i.appendChild(n),this.container=n,this.scrollContainer=r.querySelector(".scroll"),this.wrapper=r.querySelector(".wrapper"),this.canvasWrapper=r.querySelector(".canvases"),this.progressWrapper=r.querySelector(".progress"),this.cursor=r.querySelector(".cursor"),t&&r.appendChild(t),this.initEvents()}}class v extends i{start(){if(this.isRunning)return;this.isRunning=!0;let e=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(e))};e()}stop(){this.isRunning=!1,null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}}class b extends i{load(){return t(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(e){if(this.currentSrc=e,this._duration=void 0,!e)return this.buffer=null,void this.emit("emptied");fetch(e).then(t=>{if(t.status>=400)throw Error("Failed to fetch ".concat(e,": ").concat(t.status," (").concat(t.statusText,")"));return t.arrayBuffer()}).then(t=>this.currentSrc!==e?null:this.audioContext.decodeAudioData(t)).then(t=>{this.currentSrc===e&&(this.buffer=t,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())}).catch(e=>{console.error("WebAudioPlayer load error:",e)})}_play(){if(!this.paused)return;this.paused=!1,this.bufferNode&&(this.bufferNode.onended=null,this.bufferNode.disconnect()),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let e=this.playedDuration*this._playbackRate;(e>=this.duration||e<0)&&(e=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,e),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var e;this.paused=!0,null==(e=this.bufferNode)||e.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return t(this,void 0,void 0,function*(){this.paused&&(this._play(),this.emit("play"))})}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(e){let t=e-this.currentTime,i=this.bufferNode;null==i||i.stop(this.audioContext.currentTime+t),null==i||i.addEventListener("ended",()=>{i===this.bufferNode&&(this.bufferNode=null,this.pause())},{once:!0})}setSinkId(e){return t(this,void 0,void 0,function*(){return this.audioContext.setSinkId(e)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this.bufferNode&&(this.bufferNode.playbackRate.value=e)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(e){let t=!this.paused;t&&this._pause(),this.playedDuration=e/this._playbackRate,t&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var e,t;return null!=(e=this._duration)?e:(null==(t=this.buffer)?void 0:t.duration)||0}set duration(e){this._duration=e}get volume(){return this.gainNode.gain.value}set volume(e){this.gainNode.gain.value=e,this.emit("volumechange")}get muted(){return this._muted}set muted(e){this._muted!==e&&(this._muted=e,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(e){return/^(audio|video)\//.test(e)}getGainNode(){return this.gainNode}getChannelData(){let e=[];if(!this.buffer)return e;let t=this.buffer.numberOfChannels;for(let i=0;i<t;i++)e.push(this.buffer.getChannelData(i));return e}removeAttribute(e){switch(e){case"src":this.src="";break;case"playbackRate":this.playbackRate=0;break;case"currentTime":this.currentTime=0;break;case"duration":this.duration=0;break;case"volume":this.volume=0;break;case"muted":this.muted=!1}}constructor(e=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}}let y={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class x extends u{static create(e){return new x(e)}getState(){return this.wavesurferState}getRenderer(){return this.renderer}updateProgress(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getCurrentTime();return this.renderer.renderProgress(e/this.getDuration(),this.isPlaying()),e}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{if(!this.isSeeking()){let e=this.updateProgress();this.emit("timeupdate",e),this.emit("audioprocess",e),null!=this.stopAtPosition&&this.isPlaying()&&e>=this.stopAtPosition&&this.pause()}}))}initReactiveState(){this.reactiveCleanups.push(function(e,t){let i=[];i.push(h(()=>{let i=e.isPlaying.value;t.emit(i?"play":"pause")},[e.isPlaying])),i.push(h(()=>{let i=e.currentTime.value;t.emit("timeupdate",i),e.isPlaying.value&&t.emit("audioprocess",i)},[e.currentTime,e.isPlaying])),i.push(h(()=>{e.isSeeking.value&&t.emit("seeking",e.currentTime.value)},[e.isSeeking,e.currentTime]));let n=!1;i.push(h(()=>{e.isReady.value&&!n&&(n=!0,t.emit("ready",e.duration.value))},[e.isReady,e.duration]));let r=!1;return i.push(h(()=>{let i=e.isPlaying.value,n=e.currentTime.value,s=e.duration.value,o=s>0&&n>=s;r&&!i&&o&&t.emit("finish"),r=i&&o},[e.isPlaying,e.currentTime,e.duration])),i.push(h(()=>{let i=e.zoom.value;i>0&&t.emit("zoom",i)},[e.zoom])),()=>{i.forEach(e=>e())}}(this.wavesurferState,{emit:this.emit.bind(this)}))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{let e=this.updateProgress();this.emit("timeupdate",e)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("emptied",()=>{this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("ended",()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}),this.onMediaEvent("error",()=>{var e;this.emit("error",null!=(e=this.getMediaElement().error)?e:Error("Media error")),this.stopAtPosition=null}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(e,t)=>{this.options.interact&&(this.seekTo(e),this.emit("interaction",e*this.getDuration()),this.emit("click",e,t))}),this.renderer.on("dblclick",(e,t)=>{this.emit("dblclick",e,t)}),this.renderer.on("scroll",(e,t,i,n)=>{let r=this.getDuration();this.emit("scroll",e*r,t*r,i,n)}),this.renderer.on("render",()=>{this.emit("redraw")}),this.renderer.on("rendered",()=>{this.emit("redrawcomplete")}),this.renderer.on("dragstart",e=>{this.emit("dragstart",e)}),this.renderer.on("dragend",e=>{this.emit("dragend",e)}),this.renderer.on("resize",()=>{this.emit("resize")}));{let e,t=this.renderer.on("drag",t=>{var i;if(!this.options.interact)return;this.renderer.renderProgress(t),clearTimeout(e);let n=0,r=this.options.dragToSeek;this.isPlaying()?n=0:!0===r?n=200:r&&"object"==typeof r&&(n=null!=(i=r.debounceTime)?i:200),e=setTimeout(()=>{this.seekTo(t)},n),this.emit("interaction",t*this.getDuration()),this.emit("drag",t)});this.subscriptions.push(()=>{clearTimeout(e),t()})}}initPlugins(){var e;(null==(e=this.options.plugins)?void 0:e.length)&&this.options.plugins.forEach(e=>{this.registerPlugin(e)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach(e=>e()),this.mediaSubscriptions=[]}setOptions(e){this.options=Object.assign({},this.options,e),e.duration&&!e.peaks&&(this.decodedData=n.createBuffer(this.exportPeaks(),e.duration)),e.peaks&&e.duration&&(this.decodedData=n.createBuffer(e.peaks,e.duration)),this.renderer.setOptions(this.options),e.audioRate&&this.setPlaybackRate(e.audioRate),null!=e.mediaControls&&(this.getMediaElement().controls=e.mediaControls)}registerPlugin(e){if(this.plugins.includes(e))return e;e._init(this),this.plugins.push(e);let t=e.once("destroy",()=>{this.plugins=this.plugins.filter(t=>t!==e),this.subscriptions=this.subscriptions.filter(e=>e!==t)});return this.subscriptions.push(t),e}unregisterPlugin(e){this.plugins=this.plugins.filter(t=>t!==e),e.destroy()}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(e){return this.renderer.setScroll(e)}setScrollTime(e){let t=e/this.getDuration();this.renderer.setScrollPercentage(t)}getActivePlugins(){return this.plugins}loadAudio(e,i,r,s){return t(this,void 0,void 0,function*(){var t;if(this.emit("load",e),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,null==(t=this.abortController)||t.abort(),this.abortController=null,!i&&!r){let t=this.options.fetchParams||{};window.AbortController&&!t.signal&&(this.abortController=new AbortController,t.signal=this.abortController.signal);let n=e=>this.emit("loading",e);i=yield o.fetchBlob(e,n,t);let r=this.options.blobMimeType;r&&(i=new Blob([i],{type:r}))}this.setSrc(e,i);let a=yield new Promise(e=>{let t=s||this.getDuration();t?e(t):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",()=>e(this.getDuration()),{once:!0}))});if(!e&&!i){let e=this.getMediaElement();e instanceof b&&(e.duration=a)}if(r)this.decodedData=n.createBuffer(r,a||0);else if(i){let e=yield i.arrayBuffer();this.decodedData=yield n.decode(e,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())})}load(e,i,n){return t(this,void 0,void 0,function*(){try{return yield this.loadAudio(e,void 0,i,n)}catch(e){throw this.emit("error",e),e}})}loadBlob(e,i,n){return t(this,void 0,void 0,function*(){try{return yield this.loadAudio("",e,i,n)}catch(e){throw this.emit("error",e),e}})}zoom(e){if(!this.decodedData)throw Error("No audio loaded");this.renderer.zoom(e),this.emit("zoom",e)}getDecodedData(){return this.decodedData}exportPeaks(){let{channels:e=2,maxLength:t=8e3,precision:i=1e4}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.decodedData)throw Error("The audio has not been decoded yet");let n=Math.min(e,this.decodedData.numberOfChannels),r=[];for(let e=0;e<n;e++){let n=this.decodedData.getChannelData(e),s=[],o=n.length/t;for(let e=0;e<t;e++){let t=n.slice(Math.floor(e*o),Math.ceil((e+1)*o)),r=0;for(let e=0;e<t.length;e++){let i=t[e];Math.abs(i)>Math.abs(r)&&(r=i)}s.push(Math.round(r*i)/i)}r.push(s)}return r}getDuration(){let e=super.getDuration()||0;return(0===e||e===1/0)&&this.decodedData&&(e=this.decodedData.duration),e}toggleInteraction(e){this.options.interact=e}setTime(e){this.stopAtPosition=null,super.setTime(e),this.updateProgress(e),this.emit("timeupdate",e)}seekTo(e){let t=this.getDuration()*e;this.setTime(t)}play(e,i){let n=Object.create(null,{play:{get:()=>super.play}});return t(this,void 0,void 0,function*(){null!=e&&this.setTime(e);let t=yield n.play.call(this);return null!=i&&(this.media instanceof b?this.media.stopAt(i):this.stopAtPosition=i),t})}playPause(){return t(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(e){this.setTime(this.getCurrentTime()+e)}empty(){this.load("",[[0]],.001)}setMediaElement(e){this.unsubscribePlayerEvents(),super.setMediaElement(e),this.initPlayerEvents()}exportImage(){return t(this,arguments,void 0,function*(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"dataURL";return this.renderer.exportImage(e,t,i)})}destroy(){var e;this.emit("destroy"),null==(e=this.abortController)||e.abort(),this.plugins.forEach(e=>e.destroy()),this.subscriptions.forEach(e=>e()),this.unsubscribePlayerEvents(),this.reactiveCleanups.forEach(e=>e()),this.reactiveCleanups=[],this.timer.destroy(),this.renderer.destroy(),super.destroy()}constructor(e){let t=e.media||("WebAudio"===e.backend?new b:void 0);super({media:t,mediaControls:e.mediaControls,autoplay:e.autoplay,playbackRate:e.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.reactiveCleanups=[],this.options=Object.assign({},y,e);let{state:i,actions:n}=function(e){var t,i,n,r,s,o;let h=null!=(t=null==e?void 0:e.currentTime)?t:a(0),u=null!=(i=null==e?void 0:e.duration)?i:a(0),d=null!=(n=null==e?void 0:e.isPlaying)?n:a(!1),c=null!=(r=null==e?void 0:e.isSeeking)?r:a(!1),p=null!=(s=null==e?void 0:e.volume)?s:a(1),m=null!=(o=null==e?void 0:e.playbackRate)?o:a(1),g=a(null),f=a(null),v=a(""),b=a(0),y=a(0),x=l(()=>!d.value,[d]),w=l(()=>null!==g.value,[g]),C=l(()=>w.value&&u.value>0,[w,u]),S=l(()=>h.value,[h]),E=l(()=>u.value>0?h.value/u.value:0,[h,u]);return{state:{currentTime:h,duration:u,isPlaying:d,isPaused:x,isSeeking:c,volume:p,playbackRate:m,audioBuffer:g,peaks:f,url:v,zoom:b,scrollPosition:y,canPlay:w,isReady:C,progress:S,progressPercent:E},actions:{setCurrentTime:e=>{let t=Math.max(0,Math.min(u.value||1/0,e));h.set(t)},setDuration:e=>{u.set(Math.max(0,e))},setPlaying:e=>{d.set(e)},setSeeking:e=>{c.set(e)},setVolume:e=>{let t=Math.max(0,Math.min(1,e));p.set(t)},setPlaybackRate:e=>{let t=Math.max(.1,Math.min(16,e));m.set(t)},setAudioBuffer:e=>{g.set(e),e&&u.set(e.duration)},setPeaks:e=>{f.set(e)},setUrl:e=>{v.set(e)},setZoom:e=>{b.set(Math.max(0,e))},setScrollPosition:e=>{y.set(Math.max(0,e))}}}}({isPlaying:this.isPlayingSignal,currentTime:this.currentTimeSignal,duration:this.durationSignal,volume:this.volumeSignal,playbackRate:this.playbackRateSignal,isSeeking:this.seekingSignal});this.wavesurferState=i,this.wavesurferActions=n,this.timer=new v;let r=t?void 0:this.getMediaElement();this.renderer=new f(this.options,r),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initReactiveState(),this.initPlugins();let s=this.options.url||this.getSrc()||"";Promise.resolve().then(()=>{this.emit("init");let{peaks:e,duration:t}=this.options;(s||e&&t)&&this.load(s,e,t).catch(e=>{this.emit("error",e instanceof Error?e:Error(String(e)))})})}}x.BasePlugin=class extends i{onInit(){}_init(e){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e()),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}constructor(e){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=e}},x.dom=s}]);