(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,61683,e=>{"use strict";e.s(["useDebounce",()=>l],61683);var t=e.i(271645);function l(e,l,i){void 0===l&&(l=0),void 0===i&&(i=[]);var r,a,s,n,o,c,d,u=(void 0===(r=l)&&(r=0),a=(0,t.useRef)(!1),s=(0,t.useRef)(),n=(0,t.useRef)(e),o=(0,t.useCallback)(function(){return a.current},[]),c=(0,t.useCallback)(function(){a.current=!1,s.current&&clearTimeout(s.current),s.current=setTimeout(function(){a.current=!0,n.current()},r)},[r]),d=(0,t.useCallback)(function(){a.current=null,s.current&&clearTimeout(s.current)},[]),(0,t.useEffect)(function(){n.current=e},[e]),(0,t.useEffect)(function(){return c(),d},[r]),[o,d,c]),m=u[0],p=u[1],f=u[2];return(0,t.useEffect)(f,i),[m,p]}},555436,54943,e=>{"use strict";e.s(["Search",()=>t],555436),e.s(["default",()=>t],54943);let t=(0,e.i(475254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},191211,e=>{"use strict";e.s(["default",()=>i]);var t=e.i(843476),l=e.i(271645);function i(e){let{hasMore:i,next:r,threshold:a=0,root:s=null,rootMargin:n="100px",reverse:o,children:c,className:d,loader:u}=e,m=l.useRef(null),p=l.useRef(!1),[f,h]=l.useState(!1);return l.useEffect(()=>{let e=m.current;if(!e||!i)return;let t=new IntersectionObserver(async e=>{if(e[0].isIntersecting&&i&&!p.current){p.current=!0,h(!0);try{await r()}finally{p.current=!1,h(!1)}}},{threshold:a,root:s,rootMargin:n});return t.observe(e),()=>t.disconnect()},[i,r,a,s,n]),(0,t.jsxs)("div",{className:d,children:[o&&(0,t.jsx)("div",{ref:m}),c,f&&u,!o&&(0,t.jsx)("div",{ref:m})]})}},168202,8553,e=>{"use strict";e.s(["useVoiceCounts",()=>r],168202);var t=e.i(271645),l=e.i(258679),i=e.i(64585);function r(){let{hasLogin:e}=(0,i.useUser)(),[r,a]=(0,t.useState)({public:0,private:0,total:0}),[s,n]=(0,t.useState)(!0),[o,c]=(0,t.useState)(null),d=(0,t.useRef)(null),u=(0,t.useCallback)(async()=>{if(!e){a({public:0,private:0,total:0}),n(!1);return}d.current&&d.current.abort(),d.current=new AbortController,n(!0),c(null);try{let e=await (0,l.modelList)({self:!0,page_size:500,page_number:1},{signal:d.current.signal}),t=e.data.items,i=0,r=0;for(let e of t)"public"===e.visibility?i++:r++;a({public:i,private:r,total:e.data.total})}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;c(e instanceof Error?e:Error("Failed to fetch voice counts"))}finally{n(!1)}},[e]);return(0,t.useEffect)(()=>(u(),()=>{d.current&&d.current.abort()}),[u]),{counts:r,isLoading:s,error:o,refetch:u}}e.s(["VoiceSlotUpgradeModal",()=>u],8553);var a=e.i(843476),s=e.i(657688),n=e.i(585264),o=e.i(969520),c=e.i(4272),d=e.i(160889);function u(e){let{open:t,onOpenChange:l,reason:i}=e,r=(0,n.useTranslations)("voice-slots"),u=(0,d.useRouter)(),m=()=>{switch(i){case"private_not_allowed":return r("upgrade_private_locked_title");case"private_limit_reached":return r("upgrade_private_limit_title");case"public_limit_reached":return r("upgrade_public_limit_title");default:return r("upgrade_title")}};return(0,a.jsx)(o.Dialog,{open:t,onOpenChange:l,children:(0,a.jsxs)(o.DialogContent,{className:"max-w-lg overflow-hidden !rounded-[20px] border-0 p-0",onOpenAutoFocus:e=>e.preventDefault(),children:[(0,a.jsx)(o.DialogTitle,{className:"sr-only",children:m()}),(0,a.jsx)("div",{className:"relative h-[330px] w-full",children:(0,a.jsx)(s.default,{src:"https://pub-ed2d3f80bbd34baeb4b0720a347dad78.r2.dev/media/upgrade-voice-dialog.jpg",alt:"",fill:!0,sizes:"512px",className:"object-cover",quality:100,priority:!0})}),(0,a.jsxs)("div",{className:"space-y-3 px-8 pb-6 pt-4",children:[(0,a.jsx)("h2",{className:"text-[22px] font-medium leading-tight text-foreground",children:m()}),(0,a.jsx)("p",{className:"min-h-[40px] text-sm text-muted-foreground",children:(()=>{switch(i){case"private_not_allowed":return r("upgrade_private_locked_desc");case"private_limit_reached":return r("upgrade_private_limit_desc");case"public_limit_reached":return r("upgrade_public_limit_desc");default:return r("upgrade_desc")}})()}),(0,a.jsx)("div",{className:"flex items-center justify-end pt-4",children:(0,a.jsx)(c.Button,{onClick:()=>{u.push("/app/plan"),l(!1)},className:"h-auto rounded-[40px] px-8 py-2.5 font-medium dark:bg-[#d9d9d9] dark:text-black dark:hover:bg-[#c0c0c0]",children:r("view_plans")})})]})]})})}},990854,e=>{"use strict";e.s(["default",()=>t]);let t=(0,e.i(475254).default)("infinity",[["path",{d:"M6 16c5 0 7-8 12-8a4 4 0 0 1 0 8c-5 0-7-8-12-8a4 4 0 1 0 0 8",key:"18ogeb"}]])},626438,e=>{"use strict";e.s(["Infinity",()=>t.default]);var t=e.i(990854)},152392,e=>{"use strict";e.s(["default",()=>t]);let t=(0,e.i(475254).default)("list-filter",[["path",{d:"M2 5h20",key:"1fs1ex"}],["path",{d:"M6 12h12",key:"8npq4p"}],["path",{d:"M9 19h6",key:"456am0"}]])},320977,e=>{"use strict";e.s(["default",()=>R],320977);var t=e.i(843476),l=e.i(271645),i=e.i(585264),r=e.i(985693),a=e.i(880145),s=e.i(4272),n=e.i(653860),o=e.i(626438),c=e.i(152392),c=c,d=e.i(107233),u=e.i(555436),m=e.i(160889),p=e.i(247970),f=e.i(163850),h=e.i(61683),x=e.i(191211),g=e.i(531278),v=e.i(822434),b=e.i(360805),y=e.i(258679);let _=(0,l.forwardRef)((e,r)=>{let{isCreatingPendingVoice:a,loadingMessage:s,visibilityFilter:n="all",onVoiceDeleted:o}=e,c=(0,i.useTranslations)("my-models"),[d,u]=(0,l.useState)([]),[m,p]=(0,l.useState)(1),[_,j]=(0,l.useState)(10),[w,N]=(0,l.useState)(""),[k,S]=(0,l.useState)(!1),C=(0,l.useRef)(void 0),[T,I]=(0,f.useAsyncFn)(async(e,t,l)=>{var i,r;if(t>=e)return;null==(i=C.current)||i.abort(),C.current=new AbortController;let a=await (0,y.modelList)({self:!0,title:w,page_size:10,page_number:l,sort_by:"created_at"},{signal:null==(r=C.current)?void 0:r.signal});u(e=>[...e,...a.data.items].filter((e,t,l)=>t===l.findIndex(t=>t._id===e._id))),p(e=>e+1),j(a.data.total)},[w]);(0,l.useEffect)(()=>{k||(I(10,0,1),S(!0))},[k,I]);let V=(0,l.useRef)(w);(0,h.useDebounce)(()=>{k&&V.current!==w&&(p(1),j(10),u([]),I(10,0,1)),V.current=w},500,[w]);let M=e=>{N(e)},R=e=>{u(t=>[e,...t]),j(e=>e+1)},E=()=>{u([]),p(1),I(10,0,1)};(0,l.useImperativeHandle)(r,()=>({handleSearchChange:M,addNewVoice:R,refreshList:E}));let D="all"===n?d:d.filter(e=>e.visibility===n),F=_>d.length&&!T.loading;return(0,l.useEffect)(()=>{let e=document.querySelector(".dashboard-scroll");e&&e.scrollHeight<=e.clientHeight&&F&&!T.loading&&d.length>0&&I(_,d.length,m)},[d,F,T.loading,_,m,I]),(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(x.default,{className:"flex flex-col gap-3 md:gap-4",next:()=>I(_,d.length,m),hasMore:F,loader:(0,t.jsx)("div",{className:"flex w-full items-center justify-center py-10",children:(0,t.jsx)(g.Loader2,{className:"mr-2 h-4 w-4 animate-spin"})}),children:D.length||T.loading||a?(0,t.jsxs)(t.Fragment,{children:[a&&(0,t.jsxs)("div",{className:"flex items-center justify-center rounded-lg bg-gradient-to-r from-purple-200 via-violet-200 to-pink-200 p-6 dark:from-purple-900/30 dark:via-violet-900/30 dark:to-indigo-900/30",children:[(0,t.jsx)(g.Loader2,{className:"mr-2 h-5 w-5 animate-spin"}),(0,t.jsx)("span",{className:"text-sm",children:s||c("loading_sequence_0")})]}),D.map((e,l)=>(0,t.jsx)(b.VoiceRow,{data:e,onDeleted:()=>{var t;return t=e._id,void(j(e=>e-1),u(e=>{let l=e.filter(e=>e._id!==t);return p(Math.floor(l.length/10)+1),l}),null==o||o())}},l))]}):(0,t.jsxs)("div",{className:"mt-32 flex flex-col items-center justify-center",children:[(0,t.jsx)(v.default,{className:"h-28 w-28"}),(0,t.jsx)("span",{className:"mt-8 text-lg font-semibold",children:c("no_trained_voices_yet")})]})})})});_.displayName="MyVoicesTab";var j=e.i(67199),w=e.i(846696),N=e.i(64585),k=e.i(129668),S=e.i(168202),C=e.i(918871),T=e.i(8553),I=e.i(462837);function V(e){let{used:l,total:i,size:r=32,strokeWidth:a=3}=e,s=(r-a)/2,n=2*s*Math.PI,o=i===1/0,c=o?0:Math.min(l/i*100,100);return(0,t.jsx)("div",{className:"relative",style:{width:r,height:r},children:(0,t.jsxs)("svg",{className:"-rotate-90 transform",width:r,height:r,children:[(0,t.jsx)("circle",{cx:r/2,cy:r/2,r:s,fill:"none",strokeWidth:a,className:"stroke-gray-200 dark:stroke-gray-700"}),!o&&(0,t.jsx)("circle",{cx:r/2,cy:r/2,r:s,fill:"none",strokeWidth:a,strokeDasharray:n,strokeDashoffset:n-c/100*n,strokeLinecap:"round",className:"stroke-gray-700 dark:stroke-gray-300"}),o&&(0,t.jsx)("circle",{cx:r/2,cy:r/2,r:s,fill:"none",strokeWidth:a,className:"stroke-gray-700 dark:stroke-gray-300"})]})})}async function M(e,t){let l="/api/thumbnail-proxy?url=".concat(encodeURIComponent(e)),i=await fetch(l);if(!i.ok)throw Error("Failed to fetch thumbnail: ".concat(i.status));let r=await i.blob();return new File([r],t,{type:r.type})}function R(){let e=(0,i.useTranslations)(),f=(0,m.useRouter)(),h=(0,l.useRef)(null),{hasLogin:x}=(0,N.useUser)(),{userPackage:g}=(0,k.usePackage)(),{counts:v,refetch:b}=(0,S.useVoiceCounts)(),[R,E]=(0,l.useState)(!1),[D,F]=(0,l.useState)(""),[P,q]=(0,l.useState)(!1),[U,A]=(0,l.useState)("public_limit_reached"),[L,O]=(0,l.useState)("all"),B=(0,C.getVoiceSlotLimits)(null==g?void 0:g.type);(0,l.useEffect)(()=>{(async()=>{let t,l;if(!x)return;let i=sessionStorage.getItem("pendingVoiceClone");if(!i)return;sessionStorage.removeItem("pendingVoiceClone");let r=B.private>0?"private":"public",a=(0,C.canCreateVoice)(null==g?void 0:g.type,r,v);if(!a.allowed){A(a.reason),q(!0),sessionStorage.setItem("pendingVoiceClone",i);return}try{E(!0),F(e("my-models.loading_sequence_0"));let a=[e("my-models.loading_sequence_0"),e("my-models.loading_sequence_1"),e("my-models.loading_sequence_2"),e("my-models.loading_sequence_3")],s=0;t=setInterval(()=>{s=(s+1)%a.length,F(a[s])},6e3);let n=new Promise((e,t)=>{l=setTimeout(()=>{t(Error("timeout"))},9e4)}),o=JSON.parse(i),c=await fetch("data:audio/mp3;base64,".concat(o.audioBase64)).then(e=>e.blob()),d=new File([c],"voice-clone.mp3",{type:"audio/mp3"}),u=e("my-models.voice_clone_demo_title"),m=null;try{let e=function(){let e=(Math.floor(12*Math.random())+1).toString().padStart(2,"0");return"https://pub-ed2d3f80bbd34baeb4b0720a347dad78.r2.dev/voice-thumbnails/thumb-".concat(e,".webp")}();m=await M(e,"default-thumbnail.webp")}catch(e){console.error("Failed to set default thumbnail:",e)}let p={title:u,description:"",type:"tts",train_mode:"fast",visibility:r,voices:[d],cover_image:m,tags:["voice-clone-demo"],enhance_audio_quality:!0,generate_sample:!0},f=await Promise.race([(0,y.createModel)(p),n]);t&&clearInterval(t),l&&clearTimeout(l);let x=await f.json();w.toast.success(e("my-models.voice_model_saved_success")),b(),h.current?setTimeout(()=>{var e,t;x&&x._id?null==(e=h.current)||e.addNewVoice(x):null==(t=h.current)||t.refreshList()},300):setTimeout(()=>{window.location.reload()},1e3)}catch(r){t&&clearInterval(t),l&&clearTimeout(l),console.error("Failed to create pending voice model:",r),w.toast.error(e("my-models.voice_model_save_failed")),sessionStorage.setItem("pendingVoiceClone",i)}finally{E(!1),F("")}})()},[x,e,B,null==g?void 0:g.type,v,b]);let W=(()=>{let t=(null==g?void 0:g.type)||"free";if("free"===t){let t=v.public+v.private;return{used:t,total:B.public,label:"".concat(t,"/").concat(B.public),tooltip:e("voice-slots.tooltip_free")}}if("pro"===t||"paid"===t){let t=v.public+v.private;return{used:t,total:1/0,label:"".concat(t,"/"),isUnlimited:!0,tooltip:e("voice-slots.tooltip_pro")}}return{used:v.private,total:B.private,label:"".concat(v.private,"/").concat(B.private),tooltip:e("voice-slots.tooltip_plus")}})();return(0,t.jsxs)(r.DashboardPageWrapper,{title:e("my-models.my-models"),children:[(0,t.jsxs)("div",{className:"mx-auto w-full p-4 md:max-w-[80rem] md:p-6",children:[(0,t.jsx)(p.MyVoicesNavigationBar,{}),(0,t.jsxs)("div",{className:"flex flex-col justify-between md:flex-row",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-lg font-semibold",children:e("my-models.my-models")}),(0,t.jsxs)(j.Select,{value:L,onValueChange:e=>O(e),children:[(0,t.jsxs)(j.SelectTrigger,{className:"ml-2 h-8 w-auto gap-1.5 border-none bg-transparent text-sm focus:ring-0 focus:ring-offset-0 [&>svg:last-child]:hidden",children:[(0,t.jsx)(c.default,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)(j.SelectValue,{})]}),(0,t.jsxs)(j.SelectContent,{className:"rounded-xl",children:[(0,t.jsx)(j.SelectItem,{value:"all",children:e("my-models.filter_all")}),(0,t.jsx)(j.SelectItem,{value:"public",children:e("train-new-model.public")}),(0,t.jsx)(j.SelectItem,{value:"private",children:e("train-new-model.private")}),(0,t.jsx)(j.SelectItem,{value:"unlist",children:e("train-new-model.unlist")})]})]})]}),(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-3 md:mt-0",children:[(0,t.jsx)(I.TooltipProvider,{delayDuration:200,children:(0,t.jsxs)(I.Tooltip,{children:[(0,t.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("div",{className:"mr-2 flex cursor-default items-center gap-1.5",children:[(0,t.jsx)(V,{used:W.used,total:W.total,size:22,strokeWidth:2.5}),(0,t.jsxs)("span",{className:"flex items-center text-sm text-muted-foreground",children:[W.label,"isUnlimited"in W&&W.isUnlimited&&(0,t.jsx)(o.Infinity,{className:"mr-2 inline-block h-4 w-4"})," ",e("voice-slots.slots_used")]})]})}),(0,t.jsx)(I.TooltipContent,{side:"bottom",className:"max-w-xs",children:(0,t.jsx)("p",{className:"text-sm",children:W.tooltip})})]})}),(0,t.jsx)(n.InputV2,{className:"w-[13.75rem] rounded-xl max-md:flex-1",placeholder:e("my-models.search"),onChange:e=>{var t,l;return t=e.target.value,void(null==(l=h.current)||l.handleSearchChange(t))},children:(0,t.jsx)(n.InputV2Slot,{children:(0,t.jsx)(u.Search,{className:"inline-block h-5 w-5"})})}),(0,t.jsxs)(s.Button,{className:"rounded-xl max-md:p-2",onClick:()=>{f.push("/app/voice-cloning")},children:[(0,t.jsx)(d.Plus,{className:"md:mr-2"}),(0,t.jsx)("span",{className:"ml-0.5 hidden md:inline-block",children:e("my-models.train")})]})]})]}),(0,t.jsx)("div",{className:"mt-5",children:(0,t.jsx)(a.DashboardAudioControlProvider,{children:(0,t.jsx)(_,{ref:h,isCreatingPendingVoice:R,loadingMessage:D,visibilityFilter:L,onVoiceDeleted:b})})})]}),(0,t.jsx)(T.VoiceSlotUpgradeModal,{open:P,onOpenChange:q,reason:U,currentCounts:v})]})}}]);