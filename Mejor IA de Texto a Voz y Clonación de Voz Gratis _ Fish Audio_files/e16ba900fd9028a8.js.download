(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,904346,e=>{"use strict";e.s(["default",()=>tl],904346);var t=e.i(843476),s=e.i(271645),a=e.i(585264),r=e.i(227516),l=e.i(299749),i=e.i(520437);class o extends i.default{async performInitialCleanup(){try{await this.cleanupExpiredData(),await this.cleanupExcessiveData()}catch(e){console.error("Audio cache initial cleanup failed:",e)}}async addAudioHistory(e){let t=await this.audioHistory.where("taskId").equals(e.taskId).first();if(t&&t.id)return await this.audioHistory.update(t.id,{...e,timestamp:Date.now()}),t.id;if(await this.audioHistory.count()>=o.MAX_AUDIO_HISTORY){let e=await this.audioHistory.orderBy("timestamp").first();e&&e.id&&await this.audioHistory.delete(e.id)}return this.audioHistory.add({...e,timestamp:Date.now()})}async getAudioHistory(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.MAX_AUDIO_HISTORY;return this.audioHistory.orderBy("timestamp").reverse().limit(e).toArray()}async getAudioByTaskId(e){return this.audioHistory.where("taskId").equals(e).first()}async deleteAudioHistory(e){await this.audioHistory.delete(e)}async deleteAudioByTaskId(e){return this.audioHistory.where("taskId").equals(e).delete()}async cleanupExpiredData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.DEFAULT_MAX_AGE_DAYS,t=Date.now()-24*e*36e5;return this.audioHistory.where("timestamp").below(t).delete()}async cleanupExcessiveData(){let e=await this.audioHistory.count();if(e<=o.MAX_AUDIO_HISTORY)return 0;let t=e-o.MAX_AUDIO_HISTORY,s=(await this.audioHistory.orderBy("timestamp").limit(t).toArray()).map(e=>e.id).filter(e=>void 0!==e);return await this.audioHistory.bulkDelete(s),s.length}async clearAllHistory(){await this.audioHistory.clear()}async getStorageStats(){let e=await this.audioHistory.count();if(0===e)return{totalRecords:0};let t=await this.audioHistory.orderBy("timestamp").first(),s=await this.audioHistory.orderBy("timestamp").reverse().first();return{totalRecords:e,oldestRecord:t?new Date(t.timestamp):void 0,newestRecord:s?new Date(s.timestamp):void 0}}static getInstance(){return o.instance||(o.instance=new o),o.instance}constructor(){super("audio-cache"),(0,l._)(this,"audioHistory",void 0),this.version(1).stores({audioHistory:"++id, taskId, timestamp"}),this.audioHistory=this.table("audioHistory"),this.performInitialCleanup()}}(0,l._)(o,"DEFAULT_MAX_AGE_DAYS",30),(0,l._)(o,"MAX_AUDIO_HISTORY",500),(0,l._)(o,"instance",null);let d={"speech-1.5":{top_p:.7,temperature:.7},"speech-1.6":{top_p:.8,temperature:.8},"agent-x0":{top_p:.8,temperature:.8},s1:{top_p:.9,temperature:.9}},n=e=>{let t=e&&e in d?d[e]:d["speech-1.6"];return{latency:"normal",prosody:{speed:1,volume:0},sampler:{temperature:t.temperature,top_p:t.top_p}}},c=(0,s.createContext)(void 0),x="tts_draft_text",m="tts_draft_model_id";function u(e){let{children:a}=e,[r,l]=(0,s.useState)(()=>sessionStorage.getItem(x)||void 0),[i,d]=(0,s.useState)("s1"),[u,h]=(0,s.useState)(null),[p,b]=(0,s.useState)(n("s1")),[g,f]=(0,s.useState)(null),[v,j]=(0,s.useState)([]),[y,N]=(0,s.useState)(!1),_=e=>{l(e),e&&e.trim()?sessionStorage.setItem(x,e):sessionStorage.removeItem(x)},k=(0,s.useCallback)(async()=>{try{N(!0);let e=o.getInstance(),t=await e.getAudioHistory();j(t)}catch(e){console.error("load audio history failed",e)}finally{N(!1)}},[]),w=(0,s.useCallback)(async e=>{try{let t=o.getInstance();await t.addAudioHistory(e),await k()}catch(e){throw console.error("Failed to save audio history:",e),e}},[k]),C=(0,s.useCallback)(async e=>{try{let t=o.getInstance();await t.deleteAudioHistory(e),j(t=>t.filter(t=>t.id!==e))}catch(e){throw console.error("failed to delete audio history",e),e}},[]);return(0,t.jsx)(c.Provider,{value:{text:r,setText:_,version:i,setVersion:e=>{if(d(e),e){let t=n(e);b(e=>({...e,sampler:{temperature:t.sampler.temperature,top_p:t.sampler.top_p}}))}},model:u,setModel:e=>{h(e),(null==e?void 0:e._id)?sessionStorage.setItem(m,e._id):sessionStorage.removeItem(m)},audioSettings:p,setAudioSettings:b,updateAudioSettings:e=>{b(t=>({...t,...e,prosody:{...t.prosody,...e.prosody||{}},sampler:{...t.sampler,...e.sampler||{}}}))},editor:g,setEditor:f,insertSpecialNode:e=>{if(g){let t=e.startsWith("(")&&e.endsWith(")")?e.slice(1,-1):e;g.chain().focus().addPresetNode(t).run();let s=g.getText();console.log("Insert special node - text content:",s),_(s)}},wrapSelectedText:()=>{g&&(g.chain().focus().wrapInSpecialNode().run(),_(g.getText()))},removeSpecialNode:()=>{g&&(g.chain().focus().removeSpecialNode().run(),_(g.getText()))},clearDraftText:()=>{sessionStorage.removeItem(x)},getDraftText:()=>sessionStorage.getItem(x)||"",audioHistory:v,historyLoading:y,loadAudioHistory:k,addAudioHistory:w,deleteAudioHistory:C},children:a})}function h(){let e=(0,s.useContext)(c);if(void 0===e)throw Error("useInstantSpeech must be used within an InstantSpeechProvider");return e}var p=e.i(494499),b=e.i(256378),g=e.i(10552);e.i(614763);var f=e.i(827121);e.i(114337);var v=e.i(571141);let j=g.Extension.create({name:"placeholder",addOptions:()=>({emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something â€¦",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}),addProseMirrorPlugins(){return[new f.Plugin({key:new f.PluginKey("placeholder"),props:{decorations:e=>{let{doc:t,selection:s}=e,a=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=s,l=[];if(!a)return null;let i=this.editor.isEmpty;return t.descendants((e,t)=>{let s=r>=t&&r<=t+e.nodeSize,a=!e.isLeaf&&(0,g.isNodeEmpty)(e);if((s||!this.options.showOnlyCurrent)&&a){let a=[this.options.emptyNodeClass];i&&a.push(this.options.emptyEditorClass);let r=v.Decoration.node(t,t+e.nodeSize,{class:a.join(" "),"data-placeholder":"function"==typeof this.options.placeholder?this.options.placeholder({editor:this.editor,node:e,pos:t,hasAnchor:s}):this.options.placeholder});l.push(r)}return this.options.includeChildren}),v.DecorationSet.create(t,l)}}})]}});var y=e.i(734255),N=e.i(322069),_=e.i(647163);let k=e=>{let{className:a,initialContent:r="",placeholder:l,onTextChange:i,onEditorReady:o,onEditorDestroy:d}=e,n=Object.values(N.EMOTION_TYPES.nodes).map(e=>e.token.slice(1,-1)),c=(0,p.useEditor)({immediatelyRender:!1,extensions:[b.default,y.SpecialNode.configure({specialNodeRegex:/\([^()]*\)/g,presetNodes:n}),...l?[j.configure({placeholder:l})]:[]],content:r,onUpdate:e=>{let{editor:t}=e,s=t.getText();null==i||i(s)}});return(0,s.useEffect)(()=>(c&&(null==o||o(c)),()=>{null==d||d()}),[c,o,d]),(0,t.jsx)("div",{className:"special-node-editor rounded-md",children:(0,t.jsx)(p.EditorContent,{editor:c,className:(0,_.cn)("min-h-96 w-full cursor-text p-4 focus:outline-none",a),onClick:()=>null==c?void 0:c.commands.focus()})})},w=e=>{let{initialContent:s=""}=e,r=(0,a.useTranslations)("text-to-speech"),{setText:l,setEditor:i}=h();return(0,t.jsx)(k,{className:"p-0 md:p-4",placeholder:r("placeholder"),initialContent:s,onTextChange:e=>{l(e)},onEditorReady:e=>{i(e)},onEditorDestroy:()=>{i(null)}})};var C=e.i(698875),S=e.i(653145),I=e.i(994814),F=e.i(463059),T=e.i(153691),D=e.i(952571),E=e.i(50270),A=e.i(129668),P=e.i(472068),O=e.i(602946),R=e.i(4272),L=e.i(357591),z=e.i(730062),H=e.i(462837);let M=E.z.object({latency:E.z.enum(["normal","balanced"]).default("normal"),prosody:E.z.object({speed:E.z.number().min(.7).max(1.3).default(1),volume:E.z.number().min(-10).max(10).default(0)}),sampler:E.z.object({temperature:E.z.number().min(.7).max(1).default(.9),top_p:E.z.number().min(.7).max(.98).default(.9)})});function U(e){let{className:r}=e,l=(0,a.useTranslations)("studio.advanced-setting"),i=(0,a.useTranslations)("text-to-speech"),{userPackage:o}=(0,A.usePackage)(),d=(null==o?void 0:o.type)==="free",[n,c]=(0,s.useState)(!0),{audioSettings:x,updateAudioSettings:m}=h(),u=(0,S.useForm)({resolver:(0,I.zodResolver)(M),defaultValues:x});(0,s.useEffect)(()=>{u.reset(x)},[x,u]);let p=e=>{if(!d)try{m(e)}catch(e){console.error("Failed to update prosody settings:",e)}};return(0,t.jsxs)("div",{className:(0,_.cn)("flex w-full flex-col items-center rounded-none",r),children:[(0,t.jsxs)("div",{className:"hidden w-full items-center justify-between px-5 pb-4 pt-5 dark:border-[rgba(255,255,255,0.04)] md:flex",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(T.FileVolume,{size:18,className:"text-[#1D1D20] dark:text-[#5F5F6D]"}),(0,t.jsx)("span",{className:"text-sm font-medium text-[#1D1D20] dark:text-[#5F5F6D]",children:l("title")}),(0,t.jsx)(z.Badge,{variant:"outline",className:"border-white/8 rounded-full border text-xs",children:i("premium")})]}),(0,t.jsx)(R.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 dark:hover:bg-gray-800",onClick:()=>c(!n),children:(0,t.jsx)(F.ChevronRight,{size:16,className:"text-[#1D1D20] transition-transform duration-200 dark:text-[#5F5F6D] ".concat(n?"rotate-90":"rotate-180")})})]}),(0,t.jsx)("div",{className:(0,_.cn)("w-full overflow-hidden transition-all duration-300 ease-in-out",n?"opacity-100":"max-h-0 opacity-0"),children:(0,t.jsx)(O.Form,{...u,children:(0,t.jsx)("div",{className:(0,_.cn)("grid w-full gap-4 pb-4 transition-all md:px-5","grid-rows-[1fr]",d?"opacity-50":""),children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsx)(O.FormField,{name:"latency",control:u.control,render:e=>{let{field:s}=e;return(0,t.jsx)(O.FormItem,{className:"mt-2 flex flex-row items-center justify-between rounded-lg",children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(O.FormLabel,{className:"text-sm text-std-text-secondary",children:i("stable_mode")}),(0,t.jsx)(H.TooltipProvider,{children:(0,t.jsxs)(H.Tooltip,{children:[(0,t.jsx)(H.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(D.Info,{className:"h-3.5 w-3.5 cursor-pointer text-std-text-placeholder"})}),(0,t.jsx)(H.TooltipContent,{children:(0,t.jsx)("p",{className:"text-xs",children:i("stable_mode_hint")})})]})})]}),(0,t.jsx)(O.FormControl,{children:(0,t.jsx)(L.Switch,{checked:"normal"===s.value,onCheckedChange:()=>{let e="normal"!==s.value?"normal":"balanced";s.onChange(e),localStorage.setItem("tts_latency",e),p({...u.getValues(),latency:e})},disabled:d,className:"h-5 w-9 data-[state=checked]:bg-std-blue-1 [&>span]:h-4 [&>span]:w-4 [&>span]:bg-white [&>span]:data-[state=checked]:translate-x-4"})})]})})})}}),(0,t.jsx)(O.FormField,{name:"prosody.volume",control:u.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(O.FormItem,{className:"dark:text-[#5F5F6D]",children:[(0,t.jsxs)(O.FormLabel,{className:"flex items-center gap-2 dark:text-[#5F5F6D]",children:[l("volume"),(0,t.jsx)("span",{className:"text-sm text-primary",children:s.value})]}),(0,t.jsx)(O.FormControl,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs dark:text-[#5F5F6D]",children:"-10"}),(0,t.jsx)(P.Slider,{className:"flex-1 [&_[data-orientation=horizontal]>[data-orientation=horizontal]]:bg-[#C6C8D2] [&_[role=slider]]:h-4 [&_[role=slider]]:w-4 [&_[role=slider]]:cursor-grab [&_[role=slider]]:border-2 [&_[role=slider]]:border-black/40 [&_[role=slider]]:bg-[#FAFAFA] [&_[role=slider]]:ring-0 [&_[role=slider]]:ring-offset-0 [&_[role=slider]]:focus-visible:outline-none [&_[role=slider]]:focus-visible:ring-0 [&_[role=slider]]:focus-visible:ring-offset-0 [&_[role=slider]]:active:shadow-none [&_[role=slider]]:active:ring-0 [&_[role=slider]]:active:ring-offset-0",min:-10,max:10,step:.1,value:[s.value],onValueChange:e=>{let[t]=e,a=Number(t.toFixed(1));s.onChange(a);let r=u.getValues();r.prosody.volume=a,p(r)},disabled:d}),(0,t.jsx)("span",{className:"text-xs dark:text-[#5F5F6D]",children:"10"})]})})]})}}),(0,t.jsx)(O.FormField,{name:"prosody.speed",control:u.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(O.FormItem,{className:"dark:text-[#5F5F6D]",children:[(0,t.jsxs)(O.FormLabel,{className:"flex items-center gap-2",children:[l("speed"),(0,t.jsxs)("span",{className:"text-sm text-primary",children:[s.value,"x"]})]}),(0,t.jsx)(O.FormControl,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs dark:text-[#5F5F6D]",children:"0.7x"}),(0,t.jsx)(P.Slider,{className:"flex-1 [&_[data-orientation=horizontal]>[data-orientation=horizontal]]:bg-[#C6C8D2] [&_[role=slider]]:h-4 [&_[role=slider]]:w-4 [&_[role=slider]]:cursor-grab [&_[role=slider]]:border-2 [&_[role=slider]]:border-black/40 [&_[role=slider]]:bg-[#FAFAFA] [&_[role=slider]]:ring-0 [&_[role=slider]]:ring-offset-0 [&_[role=slider]]:focus-visible:outline-none [&_[role=slider]]:focus-visible:ring-0 [&_[role=slider]]:focus-visible:ring-offset-0 [&_[role=slider]]:active:shadow-none [&_[role=slider]]:active:ring-0 [&_[role=slider]]:active:ring-offset-0",min:.7,max:1.3,step:.1,value:[s.value],onValueChange:e=>{let[t]=e,a=Number(t.toFixed(1));s.onChange(a);let r=u.getValues();r.prosody.speed=a,p(r)},disabled:d}),(0,t.jsx)("span",{className:"text-xs dark:text-[#5F5F6D]",children:"1.3x"})]})})]})}}),(0,t.jsx)(O.FormField,{name:"sampler.temperature",control:u.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(O.FormItem,{className:"dark:text-[#5F5F6D]",children:[(0,t.jsxs)(O.FormLabel,{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[l("temperature"),(0,t.jsx)(H.TooltipProvider,{children:(0,t.jsxs)(H.Tooltip,{children:[(0,t.jsx)(H.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(D.Info,{className:"h-3 w-3 cursor-pointer text-std-text-placeholder"})}),(0,t.jsx)(H.TooltipContent,{children:(0,t.jsx)("p",{className:"text-xs",children:l("temperature_hint")})})]})})]}),(0,t.jsx)("span",{className:"text-sm text-primary",children:s.value})]}),(0,t.jsx)(O.FormControl,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs dark:text-[#5F5F6D]",children:"0.7"}),(0,t.jsx)(P.Slider,{className:"flex-1 [&_[data-orientation=horizontal]>[data-orientation=horizontal]]:bg-[#C6C8D2] [&_[role=slider]]:h-4 [&_[role=slider]]:w-4 [&_[role=slider]]:cursor-grab [&_[role=slider]]:border-2 [&_[role=slider]]:border-black/40 [&_[role=slider]]:bg-[#FAFAFA] [&_[role=slider]]:ring-0 [&_[role=slider]]:ring-offset-0 [&_[role=slider]]:focus-visible:outline-none [&_[role=slider]]:focus-visible:ring-0 [&_[role=slider]]:focus-visible:ring-offset-0 [&_[role=slider]]:active:shadow-none [&_[role=slider]]:active:ring-0 [&_[role=slider]]:active:ring-offset-0",min:.7,max:1,step:.01,value:[s.value],onValueChange:e=>{let[t]=e,a=Number(t.toFixed(2));s.onChange(a),p(u.getValues())},disabled:d}),(0,t.jsx)("span",{className:"text-xs dark:text-[#5F5F6D]",children:"1.0"})]})})]})}}),(0,t.jsx)(O.FormField,{name:"sampler.top_p",control:u.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(O.FormItem,{className:"dark:text-[#5F5F6D]",children:[(0,t.jsxs)(O.FormLabel,{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[l("top_p"),(0,t.jsx)(H.TooltipProvider,{children:(0,t.jsxs)(H.Tooltip,{children:[(0,t.jsx)(H.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(D.Info,{className:"h-3 w-3 cursor-pointer text-std-text-placeholder"})}),(0,t.jsx)(H.TooltipContent,{children:(0,t.jsx)("p",{className:"text-xs",children:l("top_p_hint")})})]})})]}),(0,t.jsx)("span",{className:"text-sm text-primary",children:s.value})]}),(0,t.jsx)(O.FormControl,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs dark:text-[#5F5F6D]",children:"0.7"}),(0,t.jsx)(P.Slider,{className:"flex-1 [&_[data-orientation=horizontal]>[data-orientation=horizontal]]:bg-[#C6C8D2] [&_[role=slider]]:h-4 [&_[role=slider]]:w-4 [&_[role=slider]]:cursor-grab [&_[role=slider]]:border-2 [&_[role=slider]]:border-black/40 [&_[role=slider]]:bg-[#FAFAFA] [&_[role=slider]]:ring-0 [&_[role=slider]]:ring-offset-0 [&_[role=slider]]:focus-visible:outline-none [&_[role=slider]]:focus-visible:ring-0 [&_[role=slider]]:focus-visible:ring-offset-0 [&_[role=slider]]:active:shadow-none [&_[role=slider]]:active:ring-0 [&_[role=slider]]:active:ring-offset-0",min:.7,max:.98,step:.01,value:[s.value],onValueChange:e=>{let[t]=e,a=Number(t.toFixed(2));s.onChange(a),p(u.getValues())},disabled:d}),(0,t.jsx)("span",{className:"text-xs dark:text-[#5F5F6D]",children:"0.98"})]})})]})}})]})})})})]})}var B=e.i(87309),V=e.i(558249),Y=e.i(64585),K=e.i(597887),W=e.i(828917),X=e.i(639125),G=e.i(16715),Z=e.i(360507),q=e.i(37727),Q=e.i(662031),J=e.i(245046),$=e.i(999445),ee=e.i(200997),et=e.i(657688),es=e.i(522016),ea=e.i(513959),er=e.i(173601),el=e.i(86303),ei=e.i(846696),eo=e.i(681846);function ed(e){let{model:s,onSelectTrigger:r,onSelectClose:l,isDashboard:i=!1}=e;(0,a.useTranslations)("studio");let o=(0,a.useTranslations)("text-to-speech"),{like:d,unliked:n,mark:c,count_cache:x,handleLike:m,handleUnliked:u,handleMark:p}=(0,er.useVoiceCardActions)(s),{text:b}=h();return s?(0,t.jsxs)("div",{className:"relative flex h-auto w-full flex-col items-start justify-between gap-2 overflow-hidden rounded-xl bg-std-bg-card px-4 py-3 dark:bg-std-bg-elevated",children:[(0,t.jsxs)("div",{className:"flex w-full min-w-0 items-center gap-3 pr-16",children:[(0,t.jsx)("div",{className:"relative h-[2.625rem] w-[2.625rem] shrink-0 overflow-hidden rounded-md",children:(0,t.jsx)(et.default,{src:(0,_.fetchImage)(s.cover_image),fill:!0,alt:s.title})}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col items-start",children:[(0,t.jsxs)(H.Tooltip,{children:[(0,t.jsx)(H.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(es.default,{href:i?"/app/m/".concat(s._id):"/m/".concat(s._id),className:"block max-w-full truncate font-medium",children:s.title})}),(0,t.jsx)(H.TooltipContent,{children:s.title})]}),(0,t.jsxs)("div",{className:"flex max-w-full items-center gap-2",children:[(0,t.jsxs)(ee.Avatar,{className:"h-4 w-4 shrink-0",children:[(0,t.jsx)(ee.AvatarImage,{src:(0,_.fetchImage)(s.author.avatar),alt:s.author.nickname}),(0,t.jsx)(ee.AvatarFallback,{children:(0,t.jsx)(Z.UserIcon,{className:"h-3 w-3"})})]}),(0,t.jsx)("span",{className:"truncate text-sm text-primary dark:text-muted-foreground",children:s.author.nickname})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-[#5F5F6D]",children:[(0,t.jsxs)("div",{className:"flex cursor-pointer items-center gap-1",onClick:m,children:[(0,t.jsx)(J.Heart,{className:(0,_.cn)("h-4 w-4",d?"text-red":""),fillIcon:d}),(0,t.jsx)("span",{children:x.like})]}),(0,t.jsx)("div",{className:"h-1 w-1 rounded-full bg-std-text-placeholder"}),(0,t.jsx)(ea.HeartCrackIcon,{className:(0,_.cn)("h-4 w-4 cursor-pointer",n?"fill-[#5F5F6D]":"text-[#5F5F6D]"),fillIcon:n,onClick:u}),(0,t.jsx)("div",{className:"h-1 w-1 rounded-full bg-std-text-placeholder"}),(0,t.jsxs)("div",{className:"flex cursor-pointer items-center gap-1",onClick:p,children:[(0,t.jsx)($.Bookmark,{className:(0,_.cn)("h-4 w-4",""),fillIcon:c}),(0,t.jsx)("span",{children:x.mark})]}),(0,t.jsx)("div",{className:"h-1 w-1 rounded-full bg-std-text-placeholder"}),(0,t.jsx)(el.CollectionAdditionDialog,{modelId:s._id,className:"border-none bg-std-bg-base text-sm dark:bg-std-bg-elevated dark:text-[#EEEEF1]",triggerChildren:(0,t.jsxs)("button",{className:"flex items-center gap-1",children:[(0,t.jsx)(X.ListPlus,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-xs font-semibold",children:o("collection_action")})]})}),(0,t.jsx)("div",{className:"h-1 w-1 rounded-full bg-std-text-placeholder"}),(0,t.jsxs)(eo.DropdownMenu,{children:[(0,t.jsx)(eo.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)("button",{className:"flex items-center gap-1",onClick:e=>e.stopPropagation(),children:(0,t.jsx)(Q.Share2,{className:"h-4 w-4"})})}),(0,t.jsxs)(eo.DropdownMenuContent,{align:"end",className:"min-w-[200px] border-none bg-std-bg-base text-sm dark:bg-std-bg-elevated dark:text-[#EEEEF1]",children:[(0,t.jsx)(eo.DropdownMenuItem,{onClick:e=>{e.stopPropagation();try{let e=window.location.origin,t="".concat(e,"/app/text-to-speech/?modelId=").concat(s._id);navigator.clipboard.writeText(t),ei.toast.success("Link copied")}catch(e){console.error("Failed to copy link",e),ei.toast.error("Failed to copy link")}},children:o("share_model_only")}),(0,t.jsx)(eo.DropdownMenuItem,{onClick:e=>{e.stopPropagation();try{let e=b&&b.trim()||s.default_text||"",t=window.location.origin,a="".concat(t,"/app/text-to-speech/?modelId=").concat(s._id).concat(e?"&text=".concat(encodeURIComponent(e)):"");navigator.clipboard.writeText(a),ei.toast.success("Link copied")}catch(e){console.error("Failed to copy link",e),ei.toast.error("Failed to copy link")}},children:o("share_with_current_text")})]})]})]}),(0,t.jsx)("button",{className:"absolute right-10 top-3 rounded-full bg-std-border-base p-1 dark:bg-std-bg-popover",type:"button",onClick:e=>{e.stopPropagation(),r()},"aria-label":"Refresh",children:(0,t.jsx)(G.RefreshCw,{className:"h-4 w-4 text-std-text-heading dark:text-[#fff]"})}),(0,t.jsx)("button",{className:"absolute right-2 top-3 rounded-full bg-std-border-base p-1 dark:bg-std-bg-popover",type:"button",onClick:e=>{e.stopPropagation(),l()},"aria-label":"Close",children:(0,t.jsx)(q.X,{className:"h-4 w-4 text-std-text-heading dark:text-[#fff]"})})]}):(0,t.jsxs)("div",{onClick:r,className:"flex w-full cursor-pointer items-center gap-4 rounded-xl border border-dashed border-std-gray-6 bg-std-bg-card p-4 pl-6 dark:bg-inherit",children:[(0,t.jsx)(W.CirclePlus,{className:"h-5 w-5 text-std-text-secondary"}),(0,t.jsx)("span",{className:"text-sm font-semibold text-std-text-basic",children:o("select_voice_model")})]})}var en=e.i(67199),ec=e.i(129402),ex=e.i(643531);function em(e){let{className:r,isMobile:l=!1,isDashboard:i=!1}=e,o=(0,a.useTranslations)("studio.voice-control"),{user:d}=(0,Y.useUser)(),{version:n,setVersion:c,model:x,setModel:m,editor:u,text:p,setText:b}=h(),[g,f]=(0,s.useState)(!1),[v,j]=(0,s.useState)(!0),y=[{label:"S1",labelSuffix:"(Latest)",value:"s1",description:o("model_s1_description")},{label:"V1.6",labelSuffix:"(Legacy)",value:"speech-1.6",description:o("model_v16_description")},{label:"V1.5",labelSuffix:"(Legacy)",value:"speech-1.5",description:o("model_v15_description")}];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,_.cn)("flex w-full flex-1 flex-col items-center rounded-none","md:border-b md:border-b-std-border-base",r),children:[(0,t.jsxs)("div",{className:"hidden w-full items-center justify-between px-5 pb-4 pt-5 dark:border-[rgba(255,255,255,0.04)] md:flex",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(B.AudioLines,{size:18,className:"text-[#1D1D20] dark:text-[#5F5F6D]"}),(0,t.jsx)("span",{className:"text-sm font-medium text-[#1D1D20] dark:text-[#5F5F6D]",children:o("title")})]}),(0,t.jsx)(R.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 dark:hover:bg-gray-800",onClick:()=>j(!v),children:(0,t.jsx)(F.ChevronRight,{size:16,className:"text-[#1D1D20] transition-transform duration-200 dark:text-[#5F5F6D] ".concat(v?"rotate-90":"rotate-180")})})]}),(0,t.jsxs)("div",{className:(0,_.cn)("flex w-full flex-col gap-5 md:px-5 md:pb-5","transition-all duration-300 ease-in-out",v?"opacity-100":"max-h-0 overflow-hidden p-0 opacity-0 md:p-0"),children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)(ed,{model:x,onSelectTrigger:()=>f(!0),onSelectClose:()=>m(null),isDashboard:i}),!x&&(0,t.jsx)("div",{className:"flex items-center justify-between gap-2 text-xs text-std-text-secondary",children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"mr-1",children:o("dont_have_voice_model")}),(0,t.jsx)(es.default,{href:i?"/app/voice-cloning":"/train/new-model/",className:"text-std-text-basic",children:o("create_in_a_minute")})]})})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-std-text-secondary",children:o("voice_model")}),(0,t.jsxs)(en.Select,{value:n,onValueChange:e=>{(0,V.track)("instant_speech_voice_control_bar_change_voice_model",{version:e},d),c(e)},children:[(0,t.jsx)(en.SelectTrigger,{className:"h-8 min-w-[5.25rem] max-w-[9rem] rounded-xl border-none bg-std-bg-card text-sm dark:bg-[#1D1D20] md:bg-std-bg-base",children:(0,t.jsx)(en.SelectValue,{})}),(0,t.jsx)(en.SelectContent,{className:"min-w-[16rem] rounded-xl border-none bg-std-bg-base text-sm dark:bg-std-bg-elevated dark:text-[#EEEEF1]",children:y.map(e=>(0,t.jsxs)(ec.Item,{value:e.value,className:"relative flex w-full cursor-default select-none items-center justify-between rounded-xl px-3 py-2 text-sm outline-none data-[disabled]:pointer-events-none focus:bg-accent focus:text-accent-foreground",children:[(0,t.jsxs)("div",{className:"flex flex-col items-start",children:[(0,t.jsx)(ec.ItemText,{children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:e.label}),e.labelSuffix&&(0,t.jsx)("span",{className:"text-muted-foreground",children:e.labelSuffix})]})}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:e.description})]}),(0,t.jsx)(ec.ItemIndicator,{children:(0,t.jsx)(ex.Check,{className:"h-4 w-4"})})]},e.value))})]})]})]})]}),(0,t.jsx)(K.VoiceSelectDialog,{open:g,modal:l,setOpen:f,handleUseVoice:e=>{f(!1);let t=((null==u?void 0:u.getText())||p||"").trim(),s=((null==x?void 0:x.default_text)||"").trim(),a=((null==e?void 0:e.default_text)||"").trim();(!t||t===s)&&(b(a),u&&u.commands.setContent(a)),m(e||null)},isDashboard:i})]})}function eu(e){let{isDashboard:s=!1}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(em,{isDashboard:s}),(0,t.jsx)(U,{})]})}var eh=e.i(602596),ep=e.i(717889),eb=e.i(678631),eg=e.i(941855),ef=e.i(768347),ev=e.i(465061),ej=e.i(484023),ej=ej,ey=e.i(786108),ey=ey,eN=e.i(531278),e_=e.i(495242),ek=e.i(727612),ew=e.i(268586),ew=ew,eC=e.i(951577),eS=e.i(365582),eI=e.i(163850),eF=e.i(969520),eT=e.i(710619);function eD(e){let{taskId:r,className:l,onSubmited:i,initialFeedback:o}=e,d=(0,a.useTranslations)("text-to-speech"),[n,c]=(0,s.useState)(o),[x,m]=(0,s.useState)(!1),[u,h]=(0,eI.useAsyncFn)(async()=>{await (0,ev.postTaskFeedback)({task_id:r,feedback:n}),ei.toast.success(d("feedback.submit_success"))},[n,r]),p=[{type:"INCOMPLETED",label:d("feedback.incompleted")},{type:"MULTI_SPEAKER",label:d("feedback.multi_speaker")},{type:"NOISE",label:d("feedback.noise")},{type:"LONG_BLANK",label:d("feedback.long_blank")},{type:"FUZZY_SOUND",label:d("feedback.fuzzy_sound")},{type:"REVERBERATION",label:d("feedback.reverberation")},{type:"INCORRECT",label:d("feedback.incorrect")}];(0,s.useEffect)(()=>{c(o)},[o]);let b=async()=>{if(!n)return void ei.toast.error(d("feedback.select_at_least_one"));try{await h(),m(!1),c(void 0),i&&i(n)}catch(e){ei.toast.error(d("feedback.submit_error"))}};return(0,t.jsxs)(eF.Dialog,{open:x,onOpenChange:e=>{m(e),e||c(o)},children:[(0,t.jsx)(eF.DialogTrigger,{asChild:!0,children:(0,t.jsx)(eS.ThumbsDown,{className:(0,_.cn)("h-4 w-4 scale-x-[-1] cursor-pointer",l)})}),(0,t.jsxs)(eF.DialogContent,{className:"rounded-lg border border-std-border-base bg-std-bg-elevated shadow-lg sm:max-w-[425px]",onOpenAutoFocus:e=>e.preventDefault(),children:[(0,t.jsx)(eF.DialogHeader,{children:(0,t.jsx)(eF.DialogTitle,{className:"text-std-text-secondary",children:d("feedback.title")})}),(0,t.jsxs)("div",{className:"grid gap-4",children:[(0,t.jsx)(eT.Label,{htmlFor:"feedback-type",className:"text-std-text-secondary",children:d("feedback.label")}),(0,t.jsxs)(en.Select,{value:n,onValueChange:e=>{c(e)},children:[(0,t.jsx)(en.SelectTrigger,{className:"rounded-lg border border-std-border-base bg-std-bg-card text-std-text-secondary hover:bg-std-bg-elevated focus:border-std-border-focused",children:(0,t.jsx)(en.SelectValue,{placeholder:d("feedback.placeholder"),className:"text-std-text-placeholder"})}),(0,t.jsx)(en.SelectContent,{className:"rounded-lg border border-std-border-base bg-std-bg-elevated shadow-lg",children:p.map(e=>(0,t.jsx)(en.SelectItem,{value:e.type,className:"cursor-pointer rounded-md px-3 py-2.5 text-sm text-std-text-secondary hover:bg-std-bg-card focus:bg-std-bg-card",children:(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("span",{className:"text-std-text-secondary",children:e.label})})},e.type))})]}),(0,t.jsx)(R.Button,{size:"sm",disabled:u.loading||!n,onClick:b,className:"border border-std-border-base bg-std-bg-card text-std-text-secondary hover:bg-std-bg-elevated disabled:bg-std-bg-disabled disabled:text-std-text-disabled",children:u.loading?(0,t.jsx)(eN.Loader2,{className:"h-4 w-4 animate-spin"}):d("feedback.submit")})]})]})]})}!function(e){e.INCOMPLETED="INCOMPLETED",e.MULTI_SPEAKER="MULTI_SPEAKER",e.NOISE="NOISE",e.LONG_BLANK="LONG_BLANK",e.FUZZY_SOUND="FUZZY_SOUND",e.REVERBERATION="REVERBERATION",e.INCORRECT="INCORRECT"}({});var eE=e.i(255566);function eA(e){let{isOpen:s,onClose:r,onConfirm:l,title:i,message:o}=e,d=(0,a.useTranslations)("text-to-speech");return(0,t.jsx)(eE.StandardModal,{isOpen:s,onClose:r,width:"425px",showCloseButton:!1,children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)("h2",{className:"text-lg font-semibold text-std-text-secondary",children:i||d("delete-confirm-audio.title")})}),(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)("p",{className:"text-sm text-std-text-secondary",children:o||d("delete-confirm-audio.tips")})}),(0,t.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,t.jsx)(R.Button,{variant:"outline",size:"sm",onClick:r,className:"border border-std-border-base bg-std-bg-card text-std-text-secondary hover:bg-std-bg-elevated",children:d("delete-confirm-audio.cancel")}),(0,t.jsx)(R.Button,{size:"sm",onClick:()=>{l(),r()},className:"hover:bg-red-700 border border-std-border-base bg-red text-white",children:d("delete-confirm.confirm")})]})]})})}var eP=e.i(258679);let eO=e=>{let{audioInfo:r,currentPlaying:l,isPlay:i,onPlayAudio:o,onDelete:d}=e,n=(0,s.useRef)(null),[c,x]=(0,s.useState)(!1),[m,u]=(0,s.useState)(),[p,b]=(0,s.useState)(!1),{isCN:g}=(0,eg.useEnvironment)(),{checkAndShowUpgradeDialog:f}=(0,ef.useUpgradeDialog)(),{setText:v,setModel:j,editor:y,setVersion:N}=h(),{user:k}=(0,Y.useUser)(),w=(0,a.useTranslations)("text-to-speech"),C=l===n.current&&i;(0,s.useEffect)(()=>{let e=n.current;if(!e)return;let t=()=>{l===e&&o(e,!0)};return e.addEventListener("ended",t),()=>{e.removeEventListener("ended",t)}},[l,o]);let S=(0,s.useCallback)(e=>{if(e)return(0,eP.modelInfo)({id:e}).then(e=>({name:e.data.title,imgUrl:e.data.cover_image,default_text:e.data.default_text,...e.data})).catch(()=>{ei.toast.error(w("model_unavailable"))})},[w]),I=async()=>{v(r.text||""),null==y||y.commands.setContent(r.text||""),r.version&&N(r.version);let e=await S(r.modelId||"");j(e||null),console.info("Restored model: ".concat(null==e?void 0:e.title,", text: ").concat(r.text));let t=new URL(window.location.href);t.searchParams.set("modelId",r.modelId||""),t.searchParams.set("taskId",r.taskId||""),r.version&&t.searchParams.set("version",r.version),window.history.replaceState({},"",t.toString())},F=async()=>{ei.toast.loading(w("fetching_share_url"),{id:"fetching-task-share-url"});try{let e=(await (0,ev.getTaskShareUrl)({task_id:r.taskId})).data.url;navigator.clipboard.writeText(e),ei.toast.success(w("copied_title"),{id:"fetching-task-share-url"}),(0,V.track)("user_share_audio",{model_id:r.modelId,task_id:r.taskId},k)}catch(e){ei.toast.error(w("failed_to_fetch_share_url"),{id:"fetching-task-share-url"})}},T=async()=>{let e=r.src,t=r.text||"";f(void 0,!0);try{r.taskId&&(0,ev.downLoadStats)({task_id:r.taskId});let s=g?(0,_.replaceCnDownloadUrl)(e):e,a=await fetch(s),l=await a.blob(),i=(0,_.generateFileName)(r.name||"audio",t);(0,eb.default)(l,i)}catch(e){console.error("Download failed:",e)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-std-bg-card p-2 transition-colors dark:bg-std-bg-elevated",children:[(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-3",children:[(0,t.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,t.jsxs)(ee.Avatar,{className:"h-[1.75rem] w-[1.75rem] rounded-lg",children:[(0,t.jsx)(ee.AvatarImage,{src:(0,_.fetchImage)(r.imgUrl,48),alt:r.name,loading:"lazy"}),(0,t.jsx)(ee.AvatarFallback,{className:"h-[1.75rem] w-[1.75rem] rounded-lg text-xs text-std-text-secondary",children:"Voice"})]}),(0,t.jsx)("button",{onClick:()=>{if(n.current)try{o(n.current,!n.current.paused)}catch(e){console.error(e)}},disabled:c,className:"absolute left-1/2 top-1/2 flex h-6 w-6 -translate-x-1/2 -translate-y-1/2 items-center justify-center rounded-full bg-black/60 transition-colors hover:bg-black/80",children:c?(0,t.jsx)(eN.Loader2,{className:"h-3 w-3 animate-spin text-white"}):C?(0,t.jsx)(e_.Pause,{className:"h-3 w-3 text-white"}):(0,t.jsx)(eC.PlayIcon2,{className:"h-3 w-3 text-white"})})]}),(0,t.jsx)("div",{className:"min-w-0 flex-1",children:(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("h3",{className:"max-w-[10rem] flex-1 truncate text-sm font-medium text-std-text-secondary",children:r.text})})})]}),(0,t.jsxs)("div",{className:"flex flex-shrink-0 items-center gap-3 px-3",children:[r.modelId&&(0,t.jsx)(eD,{taskId:r.taskId,initialFeedback:m,onSubmited:e=>u(e)}),(0,t.jsx)("button",{onClick:T,className:"rounded text-base transition-colors hover:text-std-text-basic",children:(0,t.jsx)(ej.default,{className:"h-4 w-4 stroke-2 text-std-text-primary dark:text-white"})}),(0,t.jsxs)(eo.DropdownMenu,{modal:!1,children:[(0,t.jsx)(eo.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)("button",{className:"rounded text-base transition-colors hover:text-std-text-basic",children:(0,t.jsx)(ey.default,{className:"h-4 w-4 text-std-text-placeholder"})})}),(0,t.jsx)(eo.DropdownMenuPortal,{children:(0,t.jsxs)(eo.DropdownMenuContent,{align:"end",className:"rounded-lg border border-std-border-base bg-std-bg-elevated shadow-lg",children:[(0,t.jsxs)(eo.DropdownMenuItem,{className:"cursor-pointer rounded-md px-3 py-2 text-sm text-std-text-secondary hover:bg-std-bg-card focus:bg-std-bg-card",onClick:I,children:[(0,t.jsx)(ew.default,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{className:"text-std-text-secondary",children:w("restore")})]}),(0,t.jsxs)(eo.DropdownMenuItem,{className:"cursor-pointer rounded-md px-3 py-2 text-sm text-std-text-secondary hover:bg-std-bg-card focus:bg-std-bg-card",onClick:F,children:[(0,t.jsx)(Q.Share2,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{className:"text-std-text-secondary",children:w("share")})]}),(0,t.jsxs)(eo.DropdownMenuItem,{className:"cursor-pointer rounded-md px-3 py-2 text-sm text-std-text-secondary hover:bg-std-bg-card focus:bg-std-bg-card",onClick:()=>{b(!0)},children:[(0,t.jsx)(ek.Trash2,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{className:"text-std-text-secondary",children:w("delete-confirm-audio.confirm")})]})]})})]})]}),(0,t.jsx)("audio",{ref:n,src:r.src,preload:"metadata"})]}),(0,t.jsx)(eA,{isOpen:p,onClose:()=>{b(!1)},onConfirm:()=>{r.id&&d&&d(r.id)}})]})};function eR(e){let{className:r}=e,l=(0,a.useTranslations)("text-to-speech"),{currentPlaying:i,setCurrentPlaying:o,isPlay:d,handlePlayAudio:n}=(0,eh.useAudioUniqueControl)(),{audioHistory:c,historyLoading:x,loadAudioHistory:m,deleteAudioHistory:u}=h();(0,s.useEffect)(()=>{m()},[m]),(0,ep.useEvent)("visibilitychange",e=>{if("hidden"===e.target.visibilityState){var t;null==i||null==(t=i.pause)||t.call(i),o(null)}});let p=async e=>{try{await u(e)}catch(e){console.error("failed to delete audio history",e)}};return(0,t.jsx)("div",{className:(0,_.cn)("flex h-full flex-1 flex-col gap-2",r),children:x?(0,t.jsx)("div",{className:"flex min-h-40 items-center justify-center",children:(0,t.jsx)(eN.Loader2,{className:"h-4 w-4 animate-spin"})}):0===c.length?(0,t.jsx)("div",{className:"py-8 text-center text-std-text-secondary",children:l("no_history_record")}):(0,t.jsx)("div",{className:"flex flex-1 flex-col space-y-2 overflow-y-auto px-5 pb-5 pt-4",children:c.map(e=>(0,t.jsx)(eO,{audioInfo:e,currentPlaying:i,isPlay:d,onPlayAudio:n,onDelete:p},e.id))})})}var eL=function(e){return e.Settings="settings",e.History="history",e}(eL||{});function ez(e){var r;let{isDashboard:l=!1}=e,i=(0,a.useTranslations)("text-to-speech"),[o,d]=(0,s.useState)("settings"),n=[{label:i("settings"),value:"settings",content:(0,t.jsx)(eu,{isDashboard:l})},{label:i("history"),value:"history",content:(0,t.jsx)(eR,{})}];return(0,t.jsxs)("div",{className:"flex flex-1 flex-col",children:[(0,t.jsx)("div",{className:(0,_.cn)("flex gap-6","md:border-b md:border-b-std-border-base","px-5 py-4"),children:n.map(e=>(0,t.jsx)("button",{onClick:()=>d(e.value),className:(0,_.cn)("text-sm font-medium",o===e.value?"font-bold text-std-text-basic":"text-std-text-secondary"),children:e.label},e.value))}),(0,t.jsx)(t.Fragment,{children:null==(r=n.find(e=>e.value===o))?void 0:r.content})]})}e.i(247167);var ej=ej,eH=e.i(299023),eM=e.i(107233),eU=e.i(367240),eB=e.i(382373),eV=e.i(181452),eY=e.i(751552),eK=e.i(129160),eW=e.i(576173),eX=e.i(790830),eG=e.i(125789),eZ=e.i(611995),eq=e.i(100574),eQ=e.i(571773),eJ=e.i(918871),e$=e.i(391096),e0=e.i(618566),e1=e.i(39839),e5=e.i(543339),e2=e.i(708640),e4=e.i(857910);function e6(e){let{className:r,audioSrc:l,taskId:i}=e,o=(0,a.useTranslations)("text-to-speech"),{model:d}=h(),n=(0,eX.useAudioRef)(),{isCN:c}=(0,eg.useEnvironment)(),{state:x,setLoading:m,setLoaded:u,getSource:p}=function(e){let[t,a]=(0,s.useState)(!1),[r,l]=(0,s.useState)(!0),[i,o]=(0,s.useState)(null),[d,n]=(0,s.useState)(""),{model:c,addAudioHistory:x}=h();(0,s.useEffect)(()=>{e&&(l(!0),a(!1),o(null),n(""))},[e]);let m=(0,s.useCallback)(async()=>{if(e)try{let s=await (0,ev.getTask)({task_id:e});if("pending"===s.data.state)return void setTimeout(m,1e3);let r=s.data.result;a(!0),o(r),n(s.data.parameters.text),l(!1);try{var t;await x({taskId:e,modelId:null==c?void 0:c._id,name:(null==c?void 0:c.title)||"Generated Audio",src:r,imgUrl:null==c?void 0:c.cover_image,text:s.data.parameters.text,version:(null==(t=s.data)?void 0:t.backend)||void 0,timestamp:Date.now()})}catch(e){console.error("Failed to save audio history:",e)}}catch(e){console.error("Failed to get audio source:",e),l(!1)}},[e,c]);return{state:{loaded:t,isLoading:r,source:i,text:d},setLoading:l,setLoaded:a,setSource:o,setText:n,getSource:m}}(i),b="string"!=typeof l&&null!==l,{checkAndShowUpgradeDialog:g}=(0,ef.useUpgradeDialog)(),{downloadAudio:f}=(0,eY.useAudioDownload)(),{isPlaying:v,play:j,pause:y,volume:N,setVolume:k,duration:w,currentTime:C,changeCurrentTime:S}=(0,eW.useAudioPlayController)(b?l:n.current,b);(0,s.useEffect)(()=>{if(b)return l.on("loadDone",p),()=>{l.off("loadDone",p)};u(!0)},[l,b,p,u]);let I=(0,s.useMemo)(()=>-1===w?"-/-":"".concat((0,eW.secondToStr)(C),"/").concat((0,eW.secondToStr)(w)),[C,w]),F=(0,s.useMemo)(()=>-1===w||0===w?0:C/w*100,[C,w]),T=e=>{-1!==w&&S(e[0]/100*w)},D=async()=>{g(void 0,!0);let e="string"==typeof l?l:x.source;if(!e)return void ei.toast.error(o("download_source_error"));if(!x.text)return void ei.toast.error(o("download_text_error"));if(i)try{(0,ev.downLoadStats)({task_id:i})}catch(e){console.error("Failed to log download stats:",e)}await f(e,{modelTitle:(null==d?void 0:d.title)||"audio",text:x.text})},E=(e,t)=>{l&&("add"===e?k(Math.min(t+5,100)):k(Math.max(t-5,0)))};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,_.cn)("border-white/8 flex flex-col gap-4 border-t p-5 md:px-8 md:py-5",r),style:{paddingBottom:"max(1.25rem, calc(1.25rem + env(safe-area-inset-bottom)))"},children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"flex flex-1 items-center md:hidden",children:(0,t.jsx)(P.Slider,{max:100,min:0,value:[F],onValueChange:T,className:(0,_.cn)("w-[100%] cursor-pointer [&_[data-radix-slider-track]]:h-[1px]","[&>*:first-child]:h-[3px] [&>*:first-child]:bg-std-text-placeholder","[&>*:first-child>*]:h-[3px] [&>*:first-child>*]:bg-std-text-basic","[&>*:last-child]:hidden")})}),(0,t.jsx)("div",{className:"block text-xs font-semibold text-std-text-basic md:hidden",children:I})]}),(0,t.jsxs)("div",{className:"flex w-full gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{onClick:v?y:j,disabled:!l,className:"rounded-full bg-std-border-base p-2 dark:bg-std-text-placeholder",children:(0,t.jsx)(t.Fragment,{children:v?(0,t.jsx)(e_.Pause,{className:"h-[14px] w-[14px] text-std-text-basic"}):(0,t.jsx)(eC.PlayIcon,{className:"h-[14px] w-[14px] text-std-text-basic"})})}),(0,t.jsxs)("div",{className:"group relative rounded-full border border-std-bg-popover p-2",children:[(0,t.jsx)("div",{className:(0,_.cn)("absolute -left-1 -top-[8.75rem] z-10 h-36 w-10 -translate-y-1 py-2","rounded-lg border border-std-border-base bg-std-bg-elevated","group-hover:block","hidden","hover:block","transition-all duration-500 ease-in-out"),children:(0,t.jsxs)("div",{className:"flex h-full w-full flex-col items-center gap-2",children:[(0,t.jsx)(eM.Plus,{className:"h-4 w-4 cursor-pointer text-std-text-basic hover:text-std-text-heading",onClick:()=>E("add",N)}),(0,t.jsx)(P.Slider,{disabled:!l,value:[100*N],onValueChange:e=>{k(e[0]/100)},max:100,min:0,orientation:"vertical",className:(0,_.cn)("flex-1 cursor-pointer")}),(0,t.jsx)(eH.Minus,{className:"h-4 w-4 cursor-pointer text-std-text-basic hover:text-std-text-heading",onClick:()=>E("minus",N)})]})}),(0,t.jsx)(eB.Volume2,{className:"h-[14px] w-[14px] cursor-pointer text-std-text-basic"})]}),(0,t.jsx)("div",{className:"hidden text-xs font-semibold text-std-text-basic md:block",children:I})]}),(0,t.jsx)("div",{className:"flex flex-1 items-center",children:(0,t.jsx)(P.Slider,{max:100,min:0,value:[F],onValueChange:T,className:(0,_.cn)("w-[100%] cursor-pointer [&_[data-radix-slider-track]]:h-[1px]","[&>*:first-child]:h-[3px] [&>*:first-child]:bg-std-text-placeholder","[&>*:first-child>*]:h-[3px] [&>*:first-child>*]:bg-std-text-basic","[&>*:last-child]:hidden","hidden md:flex")})}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("button",{disabled:!x.source||x.isLoading||!l,onClick:D,className:"flex items-center gap-1.5 rounded-lg border border-std-border-base bg-std-bg-card py-1 pl-2 pr-3 dark:bg-std-bg-popover",children:[x.isLoading?(0,t.jsx)(eN.Loader2,{className:"h-4 w-4 animate-spin text-std-text-heading"}):(0,t.jsx)(ej.default,{className:"h-4 w-4 text-std-text-heading"}),(0,t.jsx)("span",{className:"text-xs font-medium text-std-text-heading",children:o("download")})]})})]})]}),!b&&(0,t.jsx)("audio",{className:"hidden",ref:n,src:l,controls:!1,onCanPlayThrough:()=>m(!1)})]})}let e3="tts_latency",e8=["speech-1.5","speech-1.6","s1"],e7="tts_longtext_studio";function e9(e){let{emotionTokenCategories:r,insertEmotionToken:l,isVariableIconHighlighted:i,handleVariableIconClick:o,isMobile:d,version:n}=e,[c,x]=(0,s.useState)(!1),m=(0,a.useTranslations)("text-to-speech");return(0,t.jsxs)("div",{className:"flex items-center rounded-lg border border-std-border-base bg-gradient-to-t from-std-bg-elevated to-std-bg-card shadow-[0px_1px_1px_0px_rgba(14,14,17,0.04),0px_2px_4px_0px_rgba(14,14,17,0.04)] dark:bg-gradient-to-b",children:[(0,t.jsxs)(eK.Popover,{open:c,onOpenChange:x,children:[(0,t.jsx)(eK.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)("button",{className:"flex items-center gap-1 px-3 py-2 text-std-text-primary hover:text-std-text-basic",onClick:()=>x(!c),children:[(0,t.jsx)("span",{className:"text-xs font-medium text-std-text-primary hover:text-std-text-basic md:text-sm",children:m("tags")}),(0,t.jsx)(F.ChevronRight,{size:14,className:(0,_.cn)("rotate-90 text-std-text-primary transition-transform duration-200 hover:text-std-text-basic",c&&"-rotate-90")})]})}),(0,t.jsx)(eK.PopoverContent,{side:"bottom",align:"start",className:(0,_.cn)("rounded-lg border border-std-border-base bg-std-bg-elevated p-3",d?"w-[calc(100vw-2rem)] max-w-sm":"w-auto"),children:(0,t.jsxs)("div",{className:"max-h-96 space-y-3 overflow-y-auto scrollbar-thin scrollbar-track-transparent scrollbar-thumb-gray-300 hover:scrollbar-thumb-gray-400 dark:scrollbar-thumb-gray-600 dark:hover:scrollbar-thumb-gray-500",children:[(0,t.jsx)(e4.EmotionControlHelp,{}),r.map((e,s)=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"text-xs font-medium text-std-text-secondary",children:e.title}),e.description&&(0,t.jsx)("div",{className:"mb-2 max-w-md break-words px-1 text-xs italic text-std-text-placeholder",children:e.description}),(0,t.jsx)("div",{className:(0,_.cn)("grid gap-2",d?"grid-cols-2":"s1"===n?"max-w-md grid-cols-4":"max-w-xs grid-cols-3"),children:e.tokens.map((e,a)=>(0,t.jsx)(R.Button,{variant:"outline",size:"sm",className:"h-auto w-full max-w-full overflow-hidden rounded border-[0.55px] border-std-border-base bg-[rgba(255,255,255,0.04)] px-1 py-0 text-xs font-medium text-[#0C8CE9] hover:bg-[#0C8CE9] hover:font-semibold hover:text-white",title:e.token,onClick:()=>{l(e.token),x(!1)},children:(0,t.jsx)("span",{className:"block truncate",children:e.token})},"".concat(s,"-").concat(a)))})]},s))]})})]}),(0,t.jsx)("div",{className:"h-5 w-[1px] bg-std-border-base"}),(0,t.jsx)("button",{onClick:o,className:(0,_.cn)("px-3 py-2 transition-colors",i?"text-blue-500":"text-std-text-secondary hover:text-std-text-primary dark:text-std-text-placeholder hover:dark:text-std-text-primary"),children:(0,t.jsx)(eV.VariableIcon,{className:"h-4 w-4"})})]})}function te(r){var l,i;let{className:o}=r,d=(0,a.useTranslations)("text-to-speech"),n=(0,a.useLocale)(),{text:c,setText:x,model:m,version:u,setVersion:p,setModel:b,audioSettings:g,updateAudioSettings:f,insertSpecialNode:v,editor:j,wrapSelectedText:y,removeSpecialNode:k,clearDraftText:w}=h(),{userPackage:C,fetchPackage:S,isLoadingPackage:I}=(0,A.usePackage)(),{checkAndShowUpgradeDialog:F,incrementGenerationCount:T,showUpgradeDialog:D}=(0,ef.useUpgradeDialog)(),{showAuthDialog:E}=(0,eG.useAuthDialog)(),{hasLogin:P,user:O,setUser:L}=(0,Y.useUser)(),z=(0,e0.useRouter)(),H=(0,e0.useSearchParams)(),M=new TextEncoder().encode(null!=c?c:"").length,U=null!=(l=null==C?void 0:C.limit)?l:500,[B,K]=(0,s.useState)(null),[W,X]=(0,s.useState)(""),[G,Z]=(0,s.useState)(!1),[q,Q]=(0,s.useState)(!1),J=(0,s.useRef)(""),$=(0,s.useRef)(!1),[ee,et]=(0,s.useState)(!1),es=(0,e1.useMediaQuery)("(max-width: 768px)"),{showInsufficientApiCreditDialog:ea}=(0,e5.useInsufficientApiCreditDialog)(),[er,el]=(0,s.useState)(!1),[eo,ed]=(0,s.useState)(!1),[en,ec]=(0,s.useState)(!1),[ex,em]=(0,s.useState)(!1),eu=(0,a.useTranslations)("studio");(0,s.useEffect)(()=>{var e;(null==O||null==(e=O.onboarding_record)?void 0:e.includes(e7))&&ec(!0)},[O]);let eh=(0,eQ.useSpecialNodeState)(j),ep=(()=>{if("s1"!==u)return[{title:"",tokens:Object.values(N.EMOTION_TYPES.nodes)}];{let e=n.startsWith("zh")?"zh":n.startsWith("ja")?"ja":"en",t=N.EMOTION_TYPES.s1[e],s=[{title:d("tokens.emotions"),tokens:Object.values(t.emotions)},{title:d("tokens.tone"),tokens:Object.values(t.tone)},{title:d("tokens.special"),tokens:Object.values(t.special),description:t.specialDescription}];return"zh"===e&&"speed"in t&&s.splice(1,0,{title:d("tokens.speed"),tokens:Object.values(t.speed)}),s.filter(e=>e.tokens.length>0)}})();(0,s.useEffect)(()=>{C&&C.balance<=0&&!I&&D()},[C,I]),(0,s.useEffect)(()=>{et(navigator.platform.includes("Mac"))},[]);let eb=(0,s.useCallback)(e=>{if(e)return(0,eP.modelInfo)({id:e}).then(t=>{let s={name:t.data.title,imgUrl:t.data.cover_image,default_text:t.data.default_text,...t.data};return console.log("Fetched model data with liked/marked status:",{modelId:e,liked:s.liked,marked:s.marked,like_count:s.like_count,mark_count:s.mark_count}),s}).catch(e=>{console.error("Failed to fetch model:",e),ei.toast.error(d("model_unavailable"))})},[d]),eg=(0,s.useCallback)(e=>e?(0,ev.getTask)({task_id:e}).then(e=>{var t,s,a,r;return console.log("Task API response:",e.data),console.log("Task text:",null==(t=e.data.parameters)?void 0:t.text),{src:(null==(s=e.data)?void 0:s.result)||"",text:(null==(a=e.data.parameters)?void 0:a.text)||"",backend:(null==(r=e.data)?void 0:r.backend)||""}}).catch(()=>{ei.toast.error(d("task_does_not_exist"))}):Promise.resolve(void 0),[d]);(0,s.useEffect)(()=>{let t=H.get("modelId"),s=H.get("taskId"),a=H.get("cloneTaskId"),r=H.get("text"),l=H.get("version");if($.current||!j)return;let i=e=>{console.log("setTextContent called with:",e),console.log("Editor available:",!!j),x(e),j?(j.commands.setContent(e),console.log("Editor content set successfully")):console.log("Editor not ready, content will be set via setText only"),J.current=e};(async()=>{let o=t,d=s,n=null,c=!1,x=null;if(a&&P)try{let{postTaskClone:t}=await e.A(951680),s=await t({task_id:a});x=await eg(s.data.task_id);let r=new URL(window.location.href);r.searchParams.delete("cloneTaskId"),r.searchParams.set("taskId",s.data.task_id),r.searchParams.set("modelId",s.data.model_id),z.replace(r.pathname+r.search),d=s.data.task_id,o=s.data.model_id,sessionStorage.removeItem("pendingCloneTaskId")}catch(t){console.error("Failed to clone task:",t);let e=new URL(window.location.href);e.searchParams.delete("cloneTaskId"),z.replace(e.pathname+e.search)}if(!o&&!d){let e=sessionStorage.getItem("tts_draft_model_id");e&&(o=e)}if(!o&&!d&&P)try{let e=await (0,ev.getModelLastUsed)({});e.data&&e.data.length>0&&(o=e.data[0]._id,n=e.data[0],c=!0,console.log("Loading latest used model:",o))}catch(e){console.log("Could not fetch latest used model:",e)}let[m,u]=await Promise.all([x||eg(d),n?Promise.resolve(n):eb(o)]),h=sessionStorage.getItem("tts_draft_text")||"",g=sessionStorage.getItem("tts_draft_model_id")||"",v=(o||t||(null==u?void 0:u._id)||"").toString(),j=!!r,y=!!(null==m?void 0:m.text),N=!(null==x?void 0:x.text)&&!j&&!y;(null==x?void 0:x.text)?i(x.text):r?i(r):(null==m?void 0:m.text)?i(m.text):h?N&&g&&g!==v&&(null==u?void 0:u.default_text)&&!c?i(u.default_text):i(h):(null==u?void 0:u.default_text)&&!c?i(u.default_text):i("");{let e=localStorage.getItem(e3),t=null!=e?e:"normal";e||localStorage.setItem(e3,t),f({latency:t})}l&&p(e8.includes(l)?l:"speech-1.5"),(null==m?void 0:m.backend)&&p(m.backend),(o||t)&&u&&(console.log("Setting model with data:",{modelId:o||t,liked:u.liked,marked:u.marked,title:u.title||u.name}),b(u)),d&&(null==m?void 0:m.src)&&(K(m.src),X(d))})(),$.current=!0},[z,H,eb,eg,x,j,f,p,b,P]);let ej=eh.isInSpecialNode||eh.isSelectedTextSpecialNode,ey=(0,s.useCallback)(async e=>{if(!P)return void E({source:"instant_speech_player_control",redirectPath:"/app/text-to-speech/"});try{Z(!0),K(null);let t=await (0,eq.getReCaptchaToken)("playground");(0,V.track)("tts.generation.attempt",{text_length:e.text.length,model_id:null==m?void 0:m._id,version:u,latency:e.latency,has_speed:void 0!==e.speed,has_volume:void 0!==e.volume},O);let s=(await Promise.all(Array.from({length:1}).map(()=>(0,ev.createTTSTask)({...e,recaptcha:t})))).map(t=>({src:t.audio,taskId:t.taskId,name:(null==m?void 0:m.title)||d("random_voice"),modelId:null==m?void 0:m._id,imgUrl:null==m?void 0:m.cover_image,text:e.text}));K(s[0].src),Q(!0),X(s[0].taskId),J.current=e.text,(0,V.track)("tts.generation.success",{text_length:e.text.length,model_id:e.model,task_id:s[0].taskId},O),S()}catch(r){var t,s,a;if(console.log(r),(0,V.track)("tts.generation.error",{text_length:e.text.length,model_id:e.model,error_type:(null==r||null==(t=r.cause)?void 0:t.message)||"unknown",error_status:null==r||null==(s=r.cause)?void 0:s.status},O),(null==r||null==(a=r.cause)?void 0:a.status)===402)switch(null==r?void 0:r.cause.message){case"Out of credits":D();break;case"Insufficient API credits":ea()}}finally{Z(!1)}},[P,E,d,m,D,Z,eq.getReCaptchaToken,ev.createTTSTask,S,O,u,ea]),e_=(0,s.useCallback)(async()=>{if(F(void 0,!0))return;if(M>U)return void ei.toast.error(d("text_to_long"));if(M<1)return void ei.toast.error(d("error-empty-text"));let e={model:null==m?void 0:m._id,text:null!=c?c:"",latency:g.latency,prosody:(0,eJ.isPaidPackage)(null==C?void 0:C.type)?g.prosody:void 0,sampler:(0,eJ.isPaidPackage)(null==C?void 0:C.type)?g.sampler:void 0,backend:u};try{await ey(e),T(),w()}catch(e){console.error(e)}},[F,M,U,d,c,m,u,g,C,T,w,ey]);(0,s.useEffect)(()=>{let e=e=>{"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),e_())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[ee,e_]);let ek=(0,s.useCallback)(async()=>{if(!P)return void E({source:"instant_speech_long_text_studio",redirectPath:"/app/text-to-speech/"});ed(!0);try{let e=await (0,e$.createStudioProject)({name:eu("untitled-project"),default_voice_id:(null==m?void 0:m._id)||"",default_backend:u||"s1"}),{data:t}=await (0,e$.postStudioProjectChapters)({project_id:e.data._id,title:eu("chapter-sidebar.default-chapter")});if((0,eJ.isPaidPackage)(null==C?void 0:C.type)){let s=(null!=c?c:"").split(/\r?\n/).filter(e=>""!==e.trim()),a=s.every(e=>new TextEncoder().encode(e).length<=2e3);s.length>0&&a&&await (0,e$.postStudioProjectChapterBlocksBatch)({project_id:e.data._id,chapter_id:t._id,contents:s,voice_id:null==m?void 0:m._id})}z.push("/app/studio/".concat(e.data._id))}catch(e){console.error("Failed to create studio project:",e),ei.toast.error(d("error-unknown"))}finally{ed(!1),el(!1)}},[P,E,m,u,c,z,eu,d,C]),ew=M>2e3;return(0,t.jsxs)("div",{className:(0,_.cn)("flex min-h-[120px] flex-col gap-4",o),style:{paddingBottom:"max(0rem, env(safe-area-inset-bottom))"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-5 md:px-8",style:{paddingBottom:"max(1.25rem, calc(1.25rem + env(safe-area-inset-bottom)))"},children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(e9,{emotionTokenCategories:ep,insertEmotionToken:e=>{v(e)},isVariableIconHighlighted:ej,handleVariableIconClick:()=>{if(j)if(eh.isSelectedTextSpecialNode)k();else if(eh.hasSelectedText)y();else if(eh.isInSpecialNode)k();else{j.chain().focus().insertContent("()").run();let{from:e}=j.state.selection;j.commands.setTextSelection(e-1)}},isMobile:es,version:u}),(0,t.jsx)(e2.CreditsRemainingBar,{className:"hidden md:flex",version:u})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"hidden items-center gap-1 py-2 text-xs text-std-text-secondary md:flex",children:[(0,t.jsx)("span",{suppressHydrationWarning:!0,children:M}),(0,t.jsx)("span",{children:"/"}),(0,t.jsx)("span",{suppressHydrationWarning:!0,children:null!=(i=null==C?void 0:C.limit)?i:0}),(0,t.jsx)("span",{children:d("characters")})]}),(0,t.jsxs)(eK.Popover,{open:er,onOpenChange:e=>{e||el(!1)},children:[(0,t.jsx)(eK.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)("button",{onClick:()=>{if(es&&ew&&!en&&!er)return void el(!0);el(!1),e_()},disabled:G||eo,onMouseEnter:()=>{es||!ew||G||eo||en||el(!0)},className:"flex items-center gap-2 rounded-lg border border-std-border-base bg-std-bg-elevated bg-gradient-to-t from-std-bg-elevated to-std-bg-card px-4 py-2 text-sm text-std-text-primary shadow-[0px_2px_4px_0px_rgba(0,0,0,0.04)] dark:bg-gradient-to-b dark:shadow-[0px_2px_4px_0px_rgba(0,0,0,0.20)]",children:[G?(0,t.jsx)(eN.Loader2,{className:"h-5 w-5 animate-spin"}):B&&c===J.current?(0,t.jsx)(eU.RotateCcw,{className:"h-5 w-5"}):(0,t.jsx)(eC.PlayIcon,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"text-sm font-semibold text-std-text-primary",children:G?d("generating"):B&&c===J.current?d("regenerate"):d("generate_and_play")}),!es&&(0,t.jsx)("span",{className:"text-xs text-std-text-secondary",children:ee?"(âŒ˜ + â†µ)":"(Ctrl + â†µ)"})]})}),(0,t.jsxs)(eK.PopoverContent,{side:"top",align:"end",className:"bg-std-bg-elevated/80 w-auto min-w-72 rounded-lg border border-std-border-base p-4 backdrop-blur-lg",onPointerDownOutside:()=>el(!1),onOpenAutoFocus:e=>e.preventDefault(),children:[(0,t.jsx)("p",{className:"mb-3 text-sm text-std-text-basic",children:d("long_text_prompt.message")}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex shrink-0 items-center gap-1.5",children:[(0,t.jsx)("input",{type:"checkbox",id:"dont-show-again",checked:ex,onChange:e=>em(e.target.checked),className:"h-3 w-3 cursor-pointer rounded border border-std-border-base bg-transparent accent-std-text-secondary"}),(0,t.jsx)("label",{htmlFor:"dont-show-again",className:"cursor-pointer whitespace-nowrap text-xs text-std-text-secondary",children:d("long_text_prompt.dont_show_again")})]}),(0,t.jsxs)("div",{className:"flex shrink-0 gap-2",children:[(0,t.jsx)(R.Button,{variant:"outline",size:"sm",onClick:()=>{el(!1),ec(!0),ex&&O&&((0,eZ.pushOnboardingRecord)({user_id:O._id,record:e7}).catch(console.error),L({...O,onboarding_record:[...O.onboarding_record||[],e7]}))},disabled:eo,className:"h-7 border-std-border-base bg-transparent px-2.5 text-xs text-std-text-secondary hover:bg-std-bg-card hover:text-std-text-primary",children:d("long_text_prompt.dismiss")}),(0,t.jsxs)(R.Button,{size:"sm",onClick:ek,disabled:eo,className:"h-7 border border-std-border-base bg-std-bg-card px-2.5 text-xs text-std-text-primary hover:bg-std-bg-popover",children:[eo?(0,t.jsx)(eN.Loader2,{className:"mr-1.5 h-3 w-3 animate-spin"}):null,d("long_text_prompt.studio")]})]})]})]})]})]})]}),(q||B)&&(0,t.jsx)("div",{className:"duration-500 ease-out animate-in slide-in-from-bottom-4",style:{paddingBottom:"max(0rem, env(safe-area-inset-bottom))"},children:(0,t.jsx)(e6,{audioSrc:B,taskId:W})})]})}var ey=ey;function tt(e){let{className:s,onOpenPanel:r,isDashboard:l=!1}=e,i=(0,a.useTranslations)("text-to-speech"),{model:o}=h();return(0,t.jsxs)(t.Fragment,{children:[function(){if(!o)return(0,t.jsxs)("div",{onClick:()=>r(!0,"settings"),className:(0,_.cn)("flex w-full cursor-pointer items-center justify-between gap-4 rounded-xl border border-dashed border-std-gray-6 bg-std-bg-card p-4 pl-6 dark:bg-inherit",s),children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(W.CirclePlus,{className:"h-5 w-5 text-std-text-secondary"}),(0,t.jsx)("span",{className:"text-sm font-semibold text-std-text-placeholder",children:i("select_voice_model")})]}),(0,t.jsx)("button",{className:"rounded text-base transition-colors hover:text-std-text-basic",children:(0,t.jsx)(ey.default,{className:"h-4 w-4 text-std-text-placeholder"})})]})}(),o?(0,t.jsxs)("div",{className:(0,_.cn)("relative flex h-auto w-full items-center justify-between gap-2 overflow-hidden rounded-xl bg-std-bg-card px-4 py-3 dark:bg-std-bg-elevated",s),children:[(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-3",children:[(0,t.jsx)("div",{className:"relative h-5 w-5 shrink-0 overflow-hidden rounded-full",children:(0,t.jsx)(et.default,{src:(0,_.fetchImage)(o.cover_image),fill:!0,alt:o.title})}),(0,t.jsx)("div",{className:"flex min-w-0 flex-1 flex-col items-start",children:(0,t.jsxs)(H.Tooltip,{children:[(0,t.jsx)(H.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(es.default,{href:l?"/app/m/".concat(o._id):"/m/".concat(o._id),className:"block max-w-full truncate text-sm font-medium text-std-text-basic",children:o.title})}),(0,t.jsx)(H.TooltipContent,{children:o.title})]})})]}),(0,t.jsx)("button",{className:"shrink-0 rounded-full bg-std-border-base p-1 dark:bg-std-bg-popover",type:"button",onClick:e=>{e.stopPropagation(),r(!0,"settings")},"aria-label":"Refresh",children:(0,t.jsx)(G.RefreshCw,{className:"h-4 w-4 text-std-text-heading dark:text-[#fff]"})})]}):null]})}var ts=e.i(593438);function ta(e){let{className:s,type:r,isOpen:l,onOpenChange:i,isDashboard:o=!1}=e,d=(0,a.useTranslations)("text-to-speech"),n=(0,a.useTranslations)("studio.voice-control");return(0,t.jsxs)(ts.Drawer,{open:l,onOpenChange:i,children:[(0,t.jsx)(ts.DrawerOverlay,{}),(0,t.jsx)(ts.DrawerContent,{className:(0,_.cn)("max-h-[80vh]",s),children:"history"===r?(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex flex-shrink-0 items-center justify-between border-b p-5",children:[(0,t.jsx)("h3",{className:"text-base font-medium text-std-text-primary",children:d("history")}),(0,t.jsx)("button",{onClick:()=>i(!1),className:"flex h-8 w-8 items-center justify-center rounded-md hover:bg-gray-100",children:(0,t.jsx)(q.X,{className:"text-std-text-primary"})})]}),(0,t.jsx)("div",{className:"overflow-y-auto",children:(0,t.jsx)(eR,{})})]}):(0,t.jsxs)("div",{className:"flex flex-col gap-2 p-5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(B.AudioLines,{size:18,className:"text-[#1D1D20] dark:text-[#5F5F6D]"}),(0,t.jsx)("span",{className:"text-sm font-medium text-[#1D1D20] dark:text-[#5F5F6D]",children:n("title")})]}),(0,t.jsx)("button",{onClick:()=>i(!1),className:"flex h-8 w-8 items-center justify-center rounded-md hover:bg-gray-100",children:(0,t.jsx)(q.X,{className:"text-std-text-primary"})})]}),(0,t.jsx)(em,{isMobile:!0,isDashboard:o}),(0,t.jsx)(U,{})]})})]})}var tr=e.i(985693);function tl(){let e=(0,a.useTranslations)("text-to-speech"),[l,i]=(0,s.useState)(!1),[o,d]=(0,s.useState)("settings");return(0,t.jsx)(tr.DashboardPageWrapper,{title:e("text_to_speech"),children:(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 text-center md:hidden md:justify-center",children:[(0,t.jsx)("div",{className:"ml-[3.5rem] flex-1 text-center md:ml-0",children:(0,t.jsx)("h3",{className:"text-sm font-medium text-std-text-secondary",children:e("text_to_speech")})}),(0,t.jsx)("button",{className:"mr-4 flex items-center justify-center rounded-xl border border-std-border-base bg-gradient-to-t p-2 transition-colors dark:bg-gradient-to-b dark:from-std-bg-elevated dark:to-std-bg-card",onClick:()=>{i(!0),d("history")},"aria-label":"History",children:(0,t.jsx)(r.History,{className:"h-5 w-5 text-std-text-secondary"})})]}),(0,t.jsx)("div",{className:"flex flex-1 overflow-hidden",children:(0,t.jsx)("div",{className:"flex flex-1 bg-[#FAFAFA] dark:bg-[#1D1D20]",children:(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)("div",{className:"flex h-full items-center justify-center",children:"Loading..."}),children:(0,t.jsxs)(u,{children:[(0,t.jsxs)(C.PanelGroup,{direction:"horizontal",children:[(0,t.jsx)(C.Panel,{className:"relative",defaultSize:80,minSize:20,children:(0,t.jsxs)("div",{className:"relative flex h-full flex-col overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex flex-1 flex-col overflow-y-auto p-5 scrollbar-thin scrollbar-track-transparent scrollbar-thumb-gray-300 hover:scrollbar-thumb-gray-400 dark:scrollbar-thumb-gray-600 dark:hover:scrollbar-thumb-gray-500",children:[(0,t.jsx)(tt,{className:"flex md:hidden",onOpenPanel:(e,t)=>{i(e),d(t)},isDashboard:!0}),(0,t.jsx)("div",{className:"flex h-full flex-col pt-5 text-std-text-basic md:pt-0",children:(0,t.jsx)(w,{})})]}),(0,t.jsx)("div",{className:"flex-shrink-0 bg-inherit md:sticky md:bottom-0",children:(0,t.jsx)(te,{})})]})}),(0,t.jsx)(C.PanelResizeHandle,{className:"hidden w-1.5 cursor-col-resize transition-colors hover:bg-blue-400 active:bg-blue-600 md:block"}),(0,t.jsx)(C.Panel,{className:"hidden min-w-[21.4375rem] md:block",defaultSize:20,minSize:18,maxSize:50,children:(0,t.jsx)("div",{className:"flex h-full flex-col overflow-hidden bg-[#EEEEF1] dark:bg-[#18181B]",children:(0,t.jsx)("div",{className:"h-full w-full overflow-y-auto scrollbar-thin scrollbar-track-transparent scrollbar-thumb-gray-300 hover:scrollbar-thumb-gray-400 dark:scrollbar-thumb-gray-600 dark:hover:scrollbar-thumb-gray-500",children:(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)("div",{className:"p-4",children:"Loading..."}),children:(0,t.jsx)(ez,{isDashboard:!0})})})})})]}),(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)("div",{className:"p-4",children:"Loading..."}),children:(0,t.jsx)(ta,{type:o,isOpen:l,onOpenChange:i,isDashboard:!0})})]})})})})]})})}}]);